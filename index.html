<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8848: The Summit (v1.2)</title>
    <meta name="description" content="ã€Š8848: The Summitã€‹æ˜¯ä¸€æ¬¾ç¡¬æ ¸çš„è–æ¯å³°ç”Ÿå­˜æ¨¡æ“¬æ–‡å­—éŠæˆ²ã€‚ç®¡ç†ä½ çš„é«”æº«ã€æ°§æ°£èˆ‡ç†æ™ºï¼ŒæŒ‘æˆ°ç„¡æ°§ç™»é ‚ä¸–ç•Œæœ€é«˜å³°ã€‚HTML5 ç¶²é ç‰ˆï¼Œå…ä¸‹è¼‰ç›´æ¥ç©ã€‚">
    <meta name="keywords" content="è–æ¯å³°éŠæˆ², æ–‡å­—éŠæˆ², ç”Ÿå­˜æ¨¡æ“¬, çˆ¬å±±éŠæˆ², ç¶²é éŠæˆ², HTML5éŠæˆ², è–æ¯å³°, ç ç©†æœ—ç‘ªå³°, 8848">
    <meta name="author" content="ä½ çš„åå­—æˆ–æš±ç¨±">

    <meta property="og:title" content="8848: çµ•å‘½æµ·æ‹” - è–æ¯å³°ç”Ÿå­˜æ¨¡æ“¬å™¨">
    <meta property="og:description" content="ç™»é ‚åªæ˜¯æ—…ç¨‹çš„ä¸€åŠï¼Œæ´»è‘—å›ä¾†æ‰æ˜¯æŒ‘æˆ°çš„å…¨éƒ¨ã€‚ä½ èƒ½å¾æœæ­»äº¡åœ°å¸¶å—ï¼Ÿ">
    <meta property="og:image" content="https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920">
    <meta name="google-site-verification" content="Z0euiR_dQoP-QVUx9y0J47sjk6CAEytYUdRQbcLHUdk" />
    <style>
        :root {
            --bg-overlay: rgba(11, 15, 25, 0.85);
            --panel-bg: rgba(22, 27, 40, 0.9);
            --text-main: #c4d7ed;
            --text-dim: #8a9eb5;
            --accent-blue: #4a90e2;
            --accent-danger: #d9534f;
            --accent-sanity: #b846d8;
            --accent-gold: #e6b800;
            --border: 1px solid #2c3e50;
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            touch-action: manipulation;
            background-color: #000;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-main);
            font-family: var(--font-mono);
            margin: 0;
            padding: 0;
            /* é—œéµä¿®æ”¹é–‹å§‹ */
            width: 100vw;
            height: 100vh;       /* èˆŠç€è¦½å™¨å‚™ç”¨ */
            height: 100dvh;      /* æ–°ç‰ˆæ‰‹æ©Ÿç€è¦½å™¨å°ˆç”¨ï¼šè‡ªå‹•æ‰£é™¤å·¥å…·åˆ—é«˜åº¦ */
            overflow: hidden;    /* ç¦æ­¢æ•´å€‹é é¢æ»¾å‹• */
            /* é—œéµä¿®æ”¹çµæŸ */
            display: flex;
            justify-content: center;
            user-select: none;
            transition: background-image 1s ease-in-out;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-overlay);
            z-index: -1;
            transition: background 0.5s;
        }

        body.blizzard-active::before {
            background: rgba(200, 220, 255, 0.2);
        }

        #app {
            width: 100%;
            max-width: 800px;
            /* é—œéµä¿®æ”¹é–‹å§‹ */
            height: 100vh;      /* èˆŠç€è¦½å™¨å‚™ç”¨ */
            height: 100dvh;     /* è‡ªå‹•èª¿æ•´é«˜åº¦ï¼Œé¿é–‹å·¥å…·åˆ— */
            /* é‡å° iPhone X ä»¥ä¸Šçš„åº•éƒ¨æ©«æ¢ (Home Indicator) å¢åŠ å®‰å…¨è·é›¢ */
            padding-bottom: env(safe-area-inset-bottom); 
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæŠŠç‰ˆé¢æ’ç ´ */
            /* é—œéµä¿®æ”¹çµæŸ */
            display: flex;
            flex-direction: column;
            position: relative;
            background: transparent;
            transition: filter 0.5s;
            overflow: hidden;
        }

        /* --- SCREENS --- */
        .screen { display: none; flex-direction: column; height: 100%; }
        .active-screen { display: flex; }

        /* --- TITLE & DIFFICULTY SCREENS --- */
        #title-screen, #difficulty-screen {
            padding: 30px;
            overflow-y: auto;
            align-items: center;
            text-align: center;
        }
        .intro-box {
            background: var(--panel-bg);
            border: 1px solid var(--accent-blue);
            padding: 25px;
            border-radius: 8px;
            text-align: left;
            margin-bottom: 20px;
            max-width: 650px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .intro-box h1 { color: #fff; text-align: center; margin-bottom: 5px; text-shadow: 0 0 10px var(--accent-blue); }
        .intro-box h2 { font-size: 1em; color: var(--accent-blue); text-align: center; margin-top: 0; margin-bottom: 20px; letter-spacing: 2px; }
        .intro-box h3 { color: var(--accent-gold); border-bottom: 1px solid #444; padding-bottom: 5px; margin-top: 20px; }
        .intro-box ul { padding-left: 20px; line-height: 1.6; color: #ddd; }
        .intro-box li { margin-bottom: 8px; }
        
        .btn-enter-shop {
            background: linear-gradient(180deg, #4a90e2 0%, #2c5f96 100%);
            color: #fff; border: 1px solid #6ab0ff;
            padding: 15px 40px; font-size: 1.5em; font-weight: bold; cursor: pointer;
            border-radius: 5px; box-shadow: 0 0 15px var(--accent-blue);
            animation: pulse-btn 2s infinite;
        }
        @keyframes pulse-btn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Difficulty Buttons */
        .diff-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0,0,0,0.5);
            border: 1px solid #444;
            color: #ccc;
            font-size: 1.1em;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }
        .diff-btn:hover { background: rgba(255,255,255,0.1); border-color: #fff; color: #fff; }
        .diff-easy { border-left: 5px solid #4caf50; }
        .diff-normal { border-left: 5px solid #4a90e2; }
        .diff-hard { border-left: 5px solid #d9534f; }
        .diff-meta { display: block; font-size: 0.8em; color: #888; margin-top: 5px; }

        /* --- SHOP --- */
        #shop-screen { padding: 20px; overflow-y: auto; z-index: 10; }
        .shop-header { position: sticky; top: 0; background: rgba(11, 15, 25, 0.95); z-index: 5; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .item-card { background: var(--panel-bg); border: var(--border); padding: 12px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .item-info { flex-grow: 1; margin-right: 10px; }
        .item-actions { text-align: right; min-width: 110px; display: flex; align-items: center; justify-content: flex-end; gap: 5px;}
        .btn-buy { background: #2c3e50; color: #fff; border: 1px solid #4a6fa5; padding: 8px 12px; cursor: pointer; border-radius: 3px; }
        .btn-buy.owned { background: #1b4f25; border-color: #2e8b57; opacity: 0.7; cursor: default;}
        .btn-start { width:100%; padding:15px; margin-top:10px; background:var(--accent-blue); color:white; border:none; font-weight:bold; font-size:1.1em; cursor:pointer;}
        .btn-qty { background: #333; color: #fff; border: 1px solid #555; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 1.1em; display: flex; justify-content: center; align-items: center; }
        .btn-qty:active { background: #555; }
        .qty-display { font-weight: bold; color: var(--accent-gold); min-width: 25px; text-align: center; }

        /* --- HUD --- */
        #game-screen { padding-bottom: 0; }
        #hud { background: rgba(8, 10, 16, 0.95); padding: 15px; border-bottom: 1px solid #333; font-size: 0.9em; z-index: 3; position: relative; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px;}
        .progress-track { height: 6px; background: #333; margin-top: 4px; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.3s; }
        .fill-stamina { background: var(--accent-gold); }
        .fill-temp { background: var(--accent-blue); }
        .fill-hunger { background: #4caf50; }
        .fill-sanity { background: var(--accent-sanity); }
        .warning-stat { animation: blink 1s infinite; border: 1px solid var(--accent-danger); }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .env-bar { display: flex; justify-content: space-between; align-items: center; background: #1a2634; padding: 8px 15px; border-radius: 4px; color: #fff; margin-bottom: 10px; }

        /* --- VIEW --- */
        #main-view { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: rgba(0,0,0,0.3); z-index: 3; position: relative; }
        .night-mode { background: rgba(0,0,0,0.7) !important; }
        .log-entry { font-size: 1em; line-height: 1.6; border-left: 3px solid #333; padding-left: 12px; animation: fadeIn 0.3s; color: #bbb; text-shadow: 1px 1px 2px #000; }
        .log-entry.event { border-color: var(--accent-gold); color: #fff; background: rgba(230, 184, 0, 0.1); padding: 8px; }
        .log-entry.critical { border-color: var(--accent-danger); color: #ff9999; border-width: 4px; font-weight: bold; background: rgba(217, 83, 79, 0.2); padding: 8px; }
        .log-entry.malignant { border-color: var(--accent-sanity); color: #e0aaff; border-width: 3px; border-style: dashed; background: rgba(184, 70, 216, 0.1); }
        .log-entry.blizzard { border-color: #fff; color: #fff; background: rgba(255, 255, 255, 0.15); text-shadow: 0 0 5px #fff; }
        .log-entry.descend { border-color: #4caf50; color: #a5d6a7; }
        .log-entry.flavor { border-color: #4a90e2; color: #8cb4e0; font-style: italic; font-size: 0.9em; opacity: 0.9; }
        .log-entry.sanity { border-color: var(--accent-sanity); color: #d8a0df; font-family: 'Times New Roman', serif; letter-spacing: 1px; }

        /* --- CONTROLS --- */
        #controls { background: rgba(17, 17, 17, 0.95); border-top: 1px solid #333; padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; z-index: 3; position: relative; }
        button.action-btn { padding: 15px 5px; background: #222; color: #ddd; border: 1px solid #444; font-family: var(--font-mono); cursor: pointer; font-size: 1em; font-weight: bold; height: 100%; min-height: 50px; }
        button.climb-btn { background: #1a2634; border-color: var(--accent-blue); color: #fff; }
        button.toggle-btn { background: #16222e; font-size: 0.9em; border-style: dashed; } 
        
        /* --- MODAL --- */
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: #161b28; border: 1px solid #444; padding: 25px; width: 95%; max-width: 700px; max-height: 90vh; overflow-y: auto; border-radius: 4px; box-shadow: 0 0 30px #000; }
        .modal-title { color: var(--accent-blue); margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; font-size: 1.4em; }
        .choice-btn { width: 100%; padding: 15px; margin-top: 10px; background: #222; border: 1px solid #555; color: #ccc; text-align: center; cursor: pointer; font-size: 1.1em; }
        .choice-btn:hover { background: #333; border-color: #888; }
        .inv-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #333; font-size: 1em; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        #hypoxia-alert { display:none; color: var(--accent-danger); font-weight: bold; animation: blink 0.5s infinite alternate; }
        #death-risk { display:none; color: var(--accent-danger); font-weight: bold; margin-right: 15px; font-size: 1.1em; }
        #blizzard-alert { display:none; color: #aaddff; font-weight: bold; text-shadow: 0 0 10px #fff; animation: blink 0.5s infinite; margin-right: 10px; }
        
        .camp-desc-box { background: rgba(255, 255, 255, 0.05); padding: 15px; border-left: 4px solid var(--accent-gold); margin-bottom: 20px; font-style: italic; color: #ddd; font-size: 1em; line-height: 1.6; }
        .camp-option { display: flex; align-items: center; justify-content: space-between; padding: 10px; border: 1px solid #333; margin-bottom: 5px; background: #111; cursor: pointer; }
        .camp-option:hover { background: #222; }
        .camp-option input { transform: scale(1.5); }

        /* End Game Summary Styles */
        .summary-box { background: #111; padding: 20px; border: 1px solid #444; margin-bottom: 20px; font-size: 1em; }
        .summary-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        .summary-log-container { max-height: 300px; overflow-y: auto; background: #000; border: 1px solid #333; padding: 15px; font-size: 0.9em; margin-top: 10px; color: #999; font-family: monospace; line-height: 1.4; }
        .result-title { font-size: 2em; font-weight: bold; margin-bottom: 15px; text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .text-win { color: var(--accent-gold); text-shadow: 0 0 10px rgba(230, 184, 0, 0.3); }
        .text-loss { color: var(--accent-danger); text-shadow: 0 0 10px rgba(217, 83, 79, 0.3); }
        .text-retreat { color: var(--accent-blue); }
        .text-green { color: #4caf50; font-weight: bold; }
        .text-red { color: #d9534f; font-weight: bold; }
        .stat-label { color: #aaa; }
        .stat-val { font-weight: bold; color: #fff; font-size: 1.1em; }
        .stat-min { font-size: 0.9em; margin-left: 8px; color: #888; }
        
        /* Blizzard Overlay Visuals */
        .blizzard-filter { filter: sepia(0.5) hue-rotate(180deg) saturate(1.5) brightness(0.9); }
        #blizzard-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,%3Csvg version="1.1" xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Ccircle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.4)"/%3E%3C/svg%3E');
            animation: snow 0.3s linear infinite;
            pointer-events: none;
            display: none;
            z-index: 2;
            opacity: 0.6;
        }
        .blizzard-active #blizzard-overlay { display: block; }
        @keyframes snow { 0% { background-position: 0 0; } 100% { background-position: 20px 50px; } }
    </style>
</head>
<body>

<div id="app">
    <div id="blizzard-overlay"></div>

    <div id="title-screen" class="screen active-screen">
        <div class="intro-box">
            <h1>ğŸ”ï¸ 8848: The Summit</h1>
            <h2>çµ•å‘½æµ·æ‹” (çµ‚æ¥µå®Œæ•´ç‰ˆ)</h2>
            <p>ã€Œç™»é ‚åªæ˜¯æ—…ç¨‹çš„ä¸€åŠï¼Œæ´»è‘—å›ä¾†æ‰æ˜¯æŒ‘æˆ°çš„å…¨éƒ¨ã€‚ã€</p>
            <p>æ­¡è¿ä¾†åˆ°åœ°çƒä¸Šæœ€æ®˜é…·çš„ç”Ÿå­˜æ¨¡æ“¬å™¨ã€‚é€™ä¸åƒ…åƒ…æ˜¯ä¸€å€‹é»æ“ŠéŠæˆ²ï¼Œé€™æ˜¯ä¸€å ´é—œæ–¼è³‡æºç®¡ç†ã€é¢¨éšªè©•ä¼°èˆ‡æ„å¿—åŠ›çš„æ¥µé™è€ƒé©—ã€‚</p>
            
            <h3>ğŸŒŸ ç‰ˆæœ¬æ ¸å¿ƒç‰¹è‰²</h3>
            <ul>
                <li><strong>ç¡¬æ ¸ç”Ÿå­˜æ©Ÿåˆ¶</strong>ï¼šåŒæ™‚ç›£æ§é«”åŠ›ã€é«”æº«ã€é£½é£Ÿåº¦èˆ‡ç†æ™ºã€‚</li>
                <li><strong>æ²ˆæµ¸å¼åœ°åœ–</strong>ï¼šå¾ã€Œçˆ†ç±³èŠ±ç”°ã€åˆ°ã€Œå¸Œæ‹‰é‡Œå°éšã€ï¼Œ16å€‹çœŸå¯¦åœ°æ¨™ã€‚</li>
                <li><strong>å‹•æ…‹å¤©æ°£ç³»çµ±</strong>ï¼šæš´é¢¨é›ªéš¨æ™‚é™è‡¨ï¼Œè¦–ç·šå—é˜»ï¼Œé«”æº«ç‹‚æ‰ã€‚</li>
                <li><strong>æ·±åº¦è£å‚™ç­–ç•¥</strong>ï¼šé›ªéŸæŒ–æ´ä¿å‘½ã€èƒ½é‡é£²æ–™é€æ”¯ç†æ™ºã€35kg è² é‡æ¥µé™ã€‚</li>
                <li><strong>å‚³å¥‡æŒ‘æˆ°ï¼šç„¡æ°§ç™»é ‚</strong>ï¼šåœ¨æ­»äº¡åœ°å¸¶æ‹’çµ•æ°§æ°£ç“¶ï¼Œç²å¾—ã€Œç„¡æ°§å¤§å¸«ã€æœ€é«˜æ¦®è­½ã€‚</li>
            </ul>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn-enter-shop" onclick="enterDifficultySelection()">é–‹å§‹æŒ‘æˆ°</button>
            </div>
        </div>
    </div>

<div id="difficulty-screen" class="screen">
        <div class="intro-box" style="text-align:center;">
            <h2>å®šç¾©ä½ çš„æ”€ç™»é¢¨æ ¼</h2>
            <p style="color:#aaa; font-size:0.9em; margin-bottom:20px;">
                ã€Œå±±ä¸å•ä½ çš„å‡ºèº«ï¼Œä½†è£å‚™èˆ‡æ±ºå¿ƒå°‡æ±ºå®šä½ çš„æ­»æœŸã€‚ã€
            </p>
            
            <button class="diff-btn" style="border-left: 5px solid #4caf50;" onclick="selectDifficulty('easy')">
                <strong>å•†æ¥­éšŠå®¢æˆ¶ (The Client)</strong>
                <div style="font-size:0.85em;; margin: 4px 0 8px 0; font-style:italic;">
                    ã€Œæˆ‘ä»˜äº†é ‚ç´šåš®å°è²»ï¼Œåªç‚ºäº†åœ¨é ‚å³°æ’æ——ã€‚é›ªå·´äººæœƒç‚ºæˆ‘é‹ªå¥½è·¯çš„ã€‚ã€
                </div>
                <span class="diff-meta">è³‡é‡‘: $16,000 | æ¶ˆè€—: ä½ | å¤©æ°£: æ™´æœ—çª—å£</span>
            </button>
            
            <button class="diff-btn" style="border-left: 5px solid #e6b800;" onclick="selectDifficulty('normal')">
                <strong>è³‡æ·±ç™»å±±å®¶ (The Alpinist)</strong>
                <div style="font-size:0.85em;; margin: 4px 0 8px 0; font-style:italic;">
                    ã€Œç‚ºäº†é€™ä¸€åˆ»æˆ‘è¨“ç·´äº†ä¸‰å¹´ã€‚æˆ‘æ•¬ç•é€™åº§å±±ï¼Œä¹Ÿåšå¥½äº†é¢å°æš´é¢¨çš„æº–å‚™ã€‚ã€
                </div>
                <span class="diff-meta">è³‡é‡‘: $14,000 | æ¶ˆè€—: æ¨™æº– | å¤©æ°£: è®Šå¹»è«æ¸¬</span>
            </button>
            
            <button class="diff-btn" style="border-left: 5px solid #ff9800;" onclick="selectDifficulty('hard')">
                <strong>é›ªå±±è¿½çµè€… (The Hunter)</strong>
                <div style="font-size:0.85em;; margin: 4px 0 8px 0; font-style:italic;">
                    ã€Œæˆ‘ä¸æ˜¯ä¾†æœè–çš„ï¼Œæˆ‘æ˜¯ä¾†ç‹©çµç´€éŒ„çš„ã€‚åœ¨æ¥µé™é‚Šç·£ï¼Œæ•ˆç‡å°±æ˜¯ç”Ÿå‘½ã€‚ã€
                </div>
                <span class="diff-meta">è³‡é‡‘: $13,000 | æ¶ˆè€—: é«˜ | å¤©æ°£: åš´é…·</span>
            </button>
            
            <button class="diff-btn" style="border-left: 5px solid #d9534f;" onclick="selectDifficulty('insane')">
                <strong>äº¡å‘½ç¨è¡Œè€… (Soloist)</strong>
                <div style="font-size:0.85em; color:#ff6b6b; margin: 4px 0 8px 0; font-style:italic;">
                    ã€Œç˜‹å­æ‰é¸é€™æ¢è·¯ã€‚æ²’æœ‰éšŠå‹ã€æ²’æœ‰å¾Œæ´ï¼Œåªæœ‰æˆ‘å’Œæ­»ç¥åœ¨è·³èˆã€‚ã€
                </div>
                <span class="diff-meta">è³‡é‡‘: $12,000 | æ¶ˆè€—: è‡´å‘½ | å¤©æ°£: ç½é›£ç´š</span>
            </button>
        </div>
    </div>
    <div id="shop-screen" class="screen">
        <div class="shop-header">
            <h2 style="margin:0; font-size: 1.8em;">ç™»å±±è£å‚™åº—</h2>
            <div style="display:flex; justify-content:space-between; margin-top:10px; font-size:1em; color:#aaa; border-bottom:1px solid #333; padding-bottom:10px;">
                <span>è³‡é‡‘: <b id="shop-money" class="text-green">$13000</b></span>
                <span>è² é‡: <b id="shop-weight">0.0</b> / 35kg</span>
            </div>
            <button onclick="startGame()" class="btn-start">é–‹å§‹æ”€ç™»</button>
        </div>
        <div id="shop-list"></div>
    </div>

    <div id="game-screen" class="screen">
        <div id="hud">
            <div class="env-bar">
                <span id="txt-location" style="font-weight:bold; font-size:1.1em;">åŸºåœ°ç‡Ÿ (0m)</span>
                <span id="txt-time">â˜€ ç™½æ™ (Step: 0/20)</span>
            </div>
            <div style="margin-top:15px;" class="status-grid">
                <div>
                    <div style="display:flex; justify-content:space-between;"><span>é«”åŠ›</span><span id="val-stam">100</span></div>
                    <div class="progress-track"><div id="bar-stam" class="progress-fill fill-stamina" style="width:100%"></div></div>
                </div>
                <div>
                    <div style="display:flex; justify-content:space-between;"><span>é«”æº«</span><span id="val-temp">37.0Â°C</span></div>
                    <div class="progress-track"><div id="bar-temp" class="progress-fill fill-temp" style="width:100%"></div></div>
                </div>
                <div>
                    <div style="display:flex; justify-content:space-between;"><span>é£½é£Ÿåº¦</span><span id="val-hung">100</span></div>
                    <div class="progress-track"><div id="bar-hung" class="progress-fill fill-hunger" style="width:100%"></div></div>
                </div>
                <div>
                    <div style="display:flex; justify-content:space-between;"><span>ç†æ™º</span><span id="val-sani">100</span></div>
                    <div class="progress-track"><div id="bar-sani" class="progress-fill fill-sanity" style="width:100%"></div></div>
                </div>
            </div>
            <div style="text-align: right; color: #888; font-size: 0.9em; margin-top: 10px;">
                <span id="blizzard-alert">â„ æš´é¢¨é›ªä¸­ (æ¶ˆè€—å¢åŠ )</span>
                <span id="death-risk">â˜  æ­»äº¡ç‡: 0%</span>
                <span id="hypoxia-alert">âš  åš´é‡ç¼ºæ°§ (æ¶ˆè€—å¢åŠ )</span>
                ä¸‹ä¸€ç‡Ÿåœ°: <span id="val-dist-camp" style="color:#fff; font-weight:bold;">100.0%</span> <span id="descend-indicator" style="display:none; color:#4caf50;">(ä¸‹å±±åŠ é€Ÿä¸­)</span>
            </div>
        </div>

        <div id="main-view"></div>

        <div id="controls">
            <button class="action-btn climb-btn" onclick="actionClimb()">è¡Œå‹• (Move)</button>
            <button class="action-btn" onclick="actionRest()">åŸåœ°ä¼‘æ¯</button>
            <button class="action-btn" onclick="openInventory()">æŸ¥çœ‹èƒŒåŒ…</button>
            <button class="action-btn toggle-btn" onclick="toggleDirection()" id="btn-toggle">â¬† æ”»é ‚ä¸­ (é»æ“Šåˆ‡æ›)</button>
        </div>
    </div>
</div>

<div id="modal-overlay">
    <div class="modal-content">
        <h3 id="modal-title" class="modal-title">æ¨™é¡Œ</h3>
        <div id="modal-body">å…§å®¹</div>
        <div id="modal-actions"></div>
    </div>
</div>

<script>
    /* --- CONFIG & ASSETS --- */
    // Dynamic Background Images (Unsplash Source)
    const BG_IMAGES = {
        title: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
        shop: "url('https://images.unsplash.com/photo-1533561098132-7507835849bf?q=80&w=1920&auto=format&fit=crop')", // Gear/Tent
        zone1: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
        zone2: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
        zone3: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
        zone4: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
        zone5: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
        blizzard: "url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?q=80&w=1920&auto=format&fit=crop')", // Everest Distance
    };

/* --- DIFFICULTY SETTINGS --- */
    const DIFFICULTIES = {
        // Tier 1: ç¶ 
        easy: { 
            money: 16000, mult: 0.8, bzMod: 0.5,
            desc: "å•†æ¥­éšŠå®¢æˆ¶",color: "#4caf50"
        },
        // Tier 2: é»ƒ (åŸæœ¬æ˜¯è—è‰²ï¼Œé€™è£¡ä¸å‹•æ•¸å€¼ï¼Œåªæ”¹ä»‹é¢é¡è‰²)
        normal: { 
            money: 14000, mult: 1.0, bzMod: 1.0,
            desc: "è³‡æ·±ç™»å±±å®¶",color: "#e6b800"
        },
        // Tier 3: æ©™ (ç¹¼æ‰¿åŸæœ¬ v1.1 Hard çš„æ•¸å€¼)
        hard: { 
            money: 13000, mult: 1.2, bzMod: 1.5,
            desc: "é›ªå±±è¿½çµè€…",color: "#ff9800"
        },
        // Tier 4: ç´… (æ–°æ•¸å€¼)
        insane: { 
            money: 12000, mult: 1.4, bzMod: 2.0,
            desc: "äº¡å‘½ç¨è¡Œè€…",color: "#d9534f"
        }
    };
    let currentDiff = 'normal'; // Default

    /* --- DATA & CONFIG --- */
    const ITEMS = [
        { id: 'coat_pro', category: 'coat', name: 'æ¥µåœ°é€£é«”è¡£', price: 4000, weight: 2.0, type: 'gear', desc: 'æ¥µå¯’é ˜åŸŸå¿…å‚™ã€‚ä¼‘æ¯èˆ‡ç¡è¦ºæ™‚é¡å¤–+15ä¿æš–ã€‚', warm: 5, campWarm: 15 },
        { id: 'coat_std', category: 'coat', name: 'æ¨™æº–ç¾½çµ¨æœ', price: 1500, weight: 2.5, type: 'gear', desc: 'æŠµæŠ—æ™®é€šå¯’å†·ã€‚ä¼‘æ¯èˆ‡ç¡è¦ºæ™‚é¡å¤–+5ä¿æš–ã€‚', warm: 3, campWarm: 5 },
        { id: 'bag_polar', category: 'bag', name: 'æ¥µåœ°ç¡è¢‹', price: 3000, weight: 4.0, type: 'gear', desc: 'é‡ä½†ä¿æš–ã€‚ç‡Ÿåœ°ç¡è¦º+50é«”åŠ›ï¼Œé«”æº«+30ã€‚' },
        { id: 'bag_basic', category: 'bag', name: 'æ™®é€šç¡è¢‹', price: 1000, weight: 1.0, type: 'gear', desc: 'è¼•ä¾¿ã€‚ç‡Ÿåœ°ç¡è¦º+50é«”åŠ›ï¼Œé«”æº«-20ã€‚' },
        { id: 'crampons', name: 'å°ˆæ¥­å†°çˆª', price: 1500, weight: 1.0, type: 'gear', desc: 'é˜²æ»‘å¢œï¼Œæ”€ç™»é«”åŠ›æ¶ˆè€—æ¸›å°‘20%ã€‚' },
        { id: 'shovel', name: 'é›ªéŸ', price: 1000, weight: 2.0, type: 'tool', desc: 'é‡å‹å·¥å…·ã€‚æŒ–é›ªæ´ä¼‘æ¯20æ™‚é–“ã€‚é«”åŠ›+30ï¼Œæ¸›å°‘é«”æº«æµå¤±ã€‚' },
        { id: 'headlamp', name: 'é«˜æµæ˜é ­ç‡ˆ', price: 500, weight: 0.3, type: 'gear', desc: 'é©…æ•£é»‘æš—ææ‡¼ã€‚å¤œæ™šæˆ–æš´é›ªè¡Œå‹•æ™‚ï¼Œç†æ™ºæ¶ˆè€—æ¸›åŠã€‚' },
        { id: 'poles', name: 'ç¢³çº–ç¶­ç™»å±±æ–', price: 800, weight: 0.5, type: 'gear', desc: 'C2å‰ç¯€çœ30%é«”åŠ›ï¼Œä¸‹æ’¤å…¨ç¨‹å›ºå®š-2æ¶ˆè€—ã€‚' },
        { id: 'stove', name: 'ä¾¿æ”œçˆå…·', price: 500, weight: 0.8, type: 'gear', desc: 'åœ¨ç‡Ÿåœ°é…åˆç‡ƒæ–™å¯å›æ»¿é«”æº«ã€‚' },
        { id: 'oxygen', name: 'æ°§æ°£ç“¶', price: 1000, weight: 6.0, type: 'use', desc: '6.0kgé‡ç‰©ã€‚æ”»é ‚å¿…éœ€å“ã€‚', effect: {stam:40, sani:20} },
        { id: 'food', name: 'é«˜ç†±é‡å£ç³§', price: 100, weight: 0.5, type: 'use', desc: 'å›45é£½é£Ÿåº¦', effect: {hung:45} },
        { id: 'fuel', name: 'å›ºé«”ç‡ƒæ–™', price: 100, weight: 0.4, type: 'use', desc: 'å›40é«”æº« (ç‡Ÿåœ°éœ€è¦é…åˆçˆå…·)', effect: {temp:40} },
        { id: 'dex', name: 'è…ä¸Šè…ºç´ ', price: 800, weight: 0.1, type: 'use', desc: 'ç‡ƒç‡’ç”Ÿå‘½(é£½é£Ÿåº¦)æ›å–çˆ†ç™¼ï¼Œç†æ™º+40', effect: {adrenaline:true} },
        { id: 'energy_drink', name: 'èƒ½é‡é£²æ–™', price: 150, weight: 0.5, type: 'use', desc: 'å›70é«”åŠ›ï¼Œä½†å‰¯ä½œç”¨å‚·èº«(ç†æ™º-30)ã€‚', effect: {hung: 10, stam: 70, sani: -30} },
        { id: 'whisky', name: 'å¨å£«å¿Œçƒˆé…’', price: 150, weight: 0.4, type: 'use', desc: 'æš–èº«çƒˆé…’ã€‚èƒ½å¢åŠ é«”æº«ä»¥åŠç†æ™ºå€¼ï¼Œä½†é†‰é…’æœƒæ¸›å°‘é«”åŠ›ã€‚', effect: {temp:30, sani:30, stam:-15} },
    ];

    const CAMPS = [0, 20, 40, 60, 80, 100];
    const CAMP_DESC = {
        20: "ã€C1 å†°å·å­¤å³¶ 5,943mã€‘<br>ä½ ä½æ–¼æ˜†å¸ƒå†°å·é ‚ç«¯çš„ä¸€å¡Šå·¨å¤§æµ®å†°ä¸Šã€‚",
        40: "ã€C2 æ²ˆé»˜å±±è°· 6,400mã€‘<br>ä½æ–¼å·¨å¤§çš„å±±è°·ç›†åœ°ä¸­ã€‚ç™½å¤©å¦‚çƒ¤ç®±ï¼Œå¤œæ™šå¦‚å†°çª–ã€‚",
        60: "ã€C3 æ´›å­å£é³¥å·¢ 7,162mã€‘<br>é€™åªæ˜¯æ›åœ¨å‚ç›´å†°å£ä¸Šçš„å¹¾å€‹å¸³ç¯·ã€‚",
        80: "ã€C4 æ­»äº¡é–€æˆ¶ 7,950mã€‘<br>ä¸€ç‰‡è¢«ç‹‚é¢¨æƒè•©çš„é»‘è‰²å²©çŸ³å¹³åŸã€‚æ°§æ°£å«é‡åƒ…ç‚ºæµ·å¹³é¢çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚",
        100: "<span style='color:var(--accent-gold); font-weight:bold;'>ã€ä¸–ç•Œä¹‹å·” 8,848mã€‘<br>ä½ çš„è…³ä¸‹æ˜¯æ•´å€‹åœ°çƒã€‚ä½†ç¾åœ¨ï¼Œæœ€å±éšªçš„æ—…ç¨‹æ‰å‰›å‰›é–‹å§‹ã€‚</span>"
    };
    
    const DAY_STEPS = 20; 
    const DAY_LENGTH = 40; 

    /* --- EVENT DATABASE (FULL CONTENT) --- */
    const EVENTS_DB = {
        blizzard: [ 
            { id: "bz_whiteout", title: "ç™½åŒ–å¤© (Whiteout)", text: "å¤©åœ°èç‚ºä¸€é«”ï¼Œåˆ†ä¸æ¸…ä¸Šä¸‹å·¦å³ã€‚ä½ å¤±å»äº†å¹³è¡¡æ„Ÿï¼Œæ„Ÿè¦ºåƒæ¼‚æµ®åœ¨ç‰›å¥¶ä¸­ã€‚", opts:[{txt:"æ†‘ç›´è¦ºèµ°", act:()=>{if(Math.random()>0.5){ return "ä½ é‹æ°£å¥½ï¼Œæ†‘è‘—ç›´è¦ºèµ°å°äº†æ–¹å‘ã€‚(ç„¡é¡å¤–æ‡²ç½°)"; } else { player.progress -= 2; player.stats.stam-=15; return "ä½ èµ°éŒ¯äº†æ–¹å‘ï¼Œæµªè²»äº†å¯¶è²´çš„é«”åŠ›ä¸¦è¿·è·¯äº†ã€‚(é€²åº¦å€’é€€ / é«”åŠ›-15)"; }}},{txt:"åŸåœ°è¹²å", act:()=>{player.stats.temp-=20; player.stats.sani+=5; return "ä½ åœä¸‹ä¾†ç­‰å¾…èƒ½è¦‹åº¦æ¢å¾©ã€‚æ¥µåº¦å¯’å†·ï¼Œä½†ç†æ™ºç¨å¾®å¹³å¾©ã€‚(é«”æº«-20 / ç†æ™º+5)";}}]},
            { id: "bz_undress", title: "å¤±æº«å¹»è¦º (Paradoxical Undressing)", text: "åœ¨ç‹‚æš´çš„é¢¨é›ªä¸­ï¼Œä½ çš„å¤§è…¦é«”æº«èª¿ç¯€ä¸­æ¨å¤±éˆã€‚ä½ çªç„¶æ„Ÿè¦ºç‡¥ç†±ç„¡æ¯”ï¼Œæƒ³è¦è„«æ‰ç¾½çµ¨æœã€‚", opts:[{txt:"ä¿æŒç†æ™º (ç†æ™ºæª¢å®š)", act:()=>{if(player.stats.sani > 40) return "ä½ å’¬ç ´èˆŒå°–ï¼Œç”¨åŠ‡ç—›è®“è‡ªå·±ä¿æŒæ¸…é†’ã€‚å¥½éšªæ²’æœ‰è„«è¡£æœã€‚"; else { player.stats.temp = player.stats.temp/2; return "ä½ çš„ç†æ™ºå·²ç¶“å´©æ½°ã€‚ä½ æ‹‰é–‹äº†æ‹‰éŠï¼Œå†·é¢¨çŒå…¥ï¼Œä½ çš„é«”æº«ç¬é–“æµå¤±ã€‚(é«”æº«æ¸›åŠ)"; }}},{txt:"åƒä¸€æŠŠé›ª", act:()=>{player.stats.temp-=10; player.stats.sani+=20; return "å†°å†·çš„é›ªåˆºæ¿€äº†é£Ÿé“ï¼Œè®“ä½ ç¬é–“æ¸…é†’éä¾†ã€‚(é«”æº«-10 / ç†æ™º+20)";}}]},
            { id: "bz_shadow", title: "é¢¨æš´ä¸­çš„äººå½±", text: "é¢¨é›ªä¸­ä¼¼ä¹æœ‰äººåœ¨å‘ä½ æ‹›æ‰‹ï¼Œç¤ºæ„ä½ åé›¢è·¯ç¹©è·Ÿè‘—ä»–èµ°æ·å¾‘ã€‚", opts:[{txt:"è·Ÿéå»", act:()=>{player.stats.stam-=30; player.deathRisk+=20; return "ä½ èµ°éå»ç™¼ç¾é‚£åªæ˜¯å²©çŸ³ã€‚ä½ æ‰é€²äº†å†°è£‚ç¸«é‚Šç·£ï¼Œå·®é»æ²’å‘½ã€‚(é«”åŠ›-30 / æ­»äº¡ç‡+20%)";}},{txt:"æŠ“ç·Šè·¯ç¹©", act:()=>{player.stats.stam-=10; player.stats.temp-=5; return "ä½ æ­»æ­»æŠ“ä½ç¹©å­ï¼Œæ‰‹æŒ‡å‡å‚·ï¼Œä½†ä¿ä½äº†æ€§å‘½ã€‚(é«”åŠ›-10 / é«”æº«-5)";}}]}
        ],
        malignant: [
            { id: "mal_cabin", title: "æº«æš–çš„å°æœ¨å±‹", text: "é¢¨é›ªåœäº†ã€‚è·¯ç¹©å·¦å´æœ‰ä¸€é–“å†’è‘—ç‚Šç…™çš„å°æœ¨å±‹ï¼Œé€å‡ºæš–å…‰ï¼Œä½ èåˆ°äº†çƒ¤è‚‰çš„é¦™å‘³ã€‚", opts: [{ txt: "èµ°éå»æ•²é–€", act: () => { player.stats.stam -= 40; player.stats.sani -= 60; return "ä½ è§£é–‹è·¯ç¹©èµ°éå»ï¼Œä¸€è…³è¸©ç©ºæ‰é€²å†°è£‚ç¸«ã€‚å“ªè£¡æœ‰ä»€éº¼æœ¨å±‹ï¼Ÿ(é«”åŠ›-40 / ç†æ™º-60)"; }}, { txt: "çŒ›æ“Šå¤§è…¿æ¸…é†’", act: () => { player.stats.stam -= 10; player.stats.sani += 5; return "åŠ‡ç—›è®“ä½ æ¸…é†’ã€‚çœ¼å‰åªæœ‰è‡´æ­»çš„é¢¨é›ªã€‚(é«”åŠ›-10 / ç†æ™º+5)"; }}] },
            { id: "mal_burden", title: "èƒŒåŒ…è£¡çš„æƒ¡é­”", text: "ä½ è¦ºå¾—èƒŒå¾Œè¶Šä¾†è¶Šé‡ï¼Œå›é ­ä¸€ç¥ï¼Œç™¼ç¾è¶´åœ¨ä½ èƒŒä¸Šçš„ä¸æ˜¯èƒŒåŒ…ï¼Œè€Œæ˜¯ä¸€éš»æ­£åœ¨å•ƒé£Ÿä½ é ¸æ¤çš„æƒ¡é¬¼ï¼", opts: [{ txt: "ç«‹åˆ»ç”©æ‰å®ƒï¼", act: () => { const keys = Object.keys(player.inventory); if(keys.length > 0) { const k = keys[Math.floor(Math.random() * keys.length)]; if(player.inventory[k]>0) player.inventory[k]--; } player.stats.sani -= 40; return "ä½ åƒç˜‹å­ä¸€æ¨£æŠŠèƒŒåŒ…ç”©åœ¨åœ°ä¸Šã€‚æ¸…é†’å¾Œç™¼ç¾ä½ å¼„ä¸Ÿäº†ç‰©è³‡ã€‚(å¤±å»ç‰©å“ / ç†æ™º-40)"; }}, { txt: "ç„¡è¦–å®ƒ", act: () => { player.stats.sani -= 80; player.stats.stam -= 10; return "ä½ èƒŒè‘—æ²ˆé‡çš„ã€Œæƒ¡é¬¼ã€ç¹¼çºŒå‰è¡Œã€‚ææ‡¼æ„Ÿæ­£åœ¨åå™¬ä½ çš„éˆé­‚ã€‚(ç†æ™º-80 / é«”åŠ›-10)"; }}] },
            { id: "mal_rope", title: "æ¶ˆå¤±çš„è·¯ç¹©", text: "ä½ ä½é ­æ‰£é–æ‰£ï¼Œç™¼ç¾æ‰‹ä¸­çš„ç¹©å­åŒ–ç‚ºç°ç‡¼é£„æ•£ã€‚ä½ è¢«å›°åœ¨äº†å‚ç›´çš„å†°å£ä¸Šï¼Œä¸Šå¤©ç„¡è·¯ã€‚", opts: [{ txt: "å¤§è²å‘¼æ•‘", act: () => { if(player.inventory['oxygen']>0) player.inventory['oxygen']--; else player.stats.stam-=30; player.stats.sani -= 50; return "ä½ åœ¨ç¨€è–„ç©ºæ°£ä¸­æµªè²»äº†æ°§æ°£å˜¶å¼ï¼Œç„¡äººå›æ‡‰ã€‚(æ°§æ°£-1æˆ–é«”åŠ›-30 / ç†æ™º-50)"; }}, { txt: "å˜—è©¦å¾’æ‰‹æ”€ç™»", act: () => { player.stats.stam -= 20; player.stats.sani -= 40; return "ä½ æŠ“å‘ä¸å­˜åœ¨çš„å²©é»ï¼Œæ‰‹æŒ‡ç‹ ç‹ æ’åœ¨å†°é¢ä¸Šã€‚(é«”åŠ›-20 / ç†æ™º-40)"; }}] },
            { id: "mal_third", title: "ç¬¬ä¸‰äºº (The Third Man)", text: "ä½ æ„Ÿè¦ºä¸€ç›´æœ‰ä¸€å€‹ã€Œçœ‹ä¸è¦‹çš„éšŠå‹ã€è·Ÿåœ¨ä½ èº«å¾Œï¼Œç”šè‡³å¹«ä½ æ‹‰äº†ä¸€ä¸‹ç¹©å­ã€‚", opts: [{ txt: "åˆ†çµ¦ä»–é£Ÿç‰©", act: () => { if(player.inventory['food']>0) player.inventory['food']--; player.stats.sani -= 20; return "ä½ æŠŠçè²´çš„å£ç³§æ’’åœ¨äº†é›ªåœ°ä¸Šï¼Œè©¦åœ–å®‰æ’«å¹»è¦ºã€‚(å¤±å»å£ç³§ / ç†æ™º-20)"; }}, { txt: "èˆ‡ä»–èªªè©±", act: () => { player.stats.sani += 10; player.stats.stam -= 20; return "ä½ å°è‘—ç©ºæ°£è‡ªè¨€è‡ªèªäº†ååˆ†é˜ï¼Œæµªè²»äº†é«”åŠ›èˆ‡æ°§æ°£ã€‚(é«”åŠ›-20 / ç†æ™º+10)"; }}] },
            { id: "mal_call", title: "å‘¼å–š", text: "åœ¨å‘¼å˜¯çš„é¢¨è²ä¸­ï¼Œä½ æ¸…æ™°åœ°è½è¦‹äº†å®¶äººåœ¨å«ä½ å›å®¶åƒé£¯ï¼Œè²éŸ³æ˜¯é‚£éº¼æº«æš–ã€çœŸå¯¦ã€‚", opts: [{ txt: "å›é ­å°‹æ‰¾", act: () => { player.progress -= 5; player.stats.sani -= 60; return "ä½ è§£é–‹é–æ‰£å¾€å›èµ°ï¼Œå·®é»æ»‘ä¸‹æ‡¸å´–ã€‚ä½ æ„è­˜åˆ°è‡ªå·±ç˜‹äº†ã€‚(é€²åº¦å€’é€€ / ç†æ™º-60)"; }}, { txt: "å¤§å¼é–‰å˜´", act: () => { player.stats.stam -= 15; return "ä½ æ†¤æ€’åœ°å˜¶å¼ï¼Œé›–ç„¶è¶•èµ°äº†è²éŸ³ï¼Œä½†å–‰åš¨è¢«å†·ç©ºæ°£ç¼å‚·ã€‚(é«”åŠ›-15)"; }}] }
        ],
        zones: [
        [ 
            { id: "z1_screw", title: "å†°èºçµ²é¬†è„«", text: "å›ºå®šè·¯ç¹©çš„å†°èºçµ²å·²ç¶“é¬†å‹•,æ–æ–æ¬²å¢œã€‚", opts:[{txt:"è‡ªè¡ŒåŠ å›º", act:()=>{player.stats.stam-=15; return "æ¶ˆè€—é«”åŠ›,ä½†ç¢ºä¿äº†å®‰å…¨ã€‚(é«”åŠ›-15)";}}, {txt:"å¿«é€Ÿé€šé", act:()=>{ if(Math.random()>0.5) return "é‹æ°£ä¸éŒ¯,èºçµ²æ²’æ‰ã€‚(ç„¡äº‹)"; else {player.stats.stam-=30; return "èºçµ²å½ˆå‡º,ä½ æ»‘è½äº†ä¸€æ®µè·é›¢!(é«”åŠ›-30)";}}}] }, 
            { id: "z1_glove", title: "éºè½çš„æ‰‹å¥—", text: "é›ªåœ°ä¸Šæœ‰ä¸€éš»çœ‹èµ·ä¾†å¾ˆæ–°çš„å°ˆæ¥­ç™»å±±æ‰‹å¥—ã€‚", opts:[{txt:"æ’¿èµ·ä¾†", act:()=>{player.stepInDay+=1; player.stats.sani+=5; return "è£¡é¢å¡æ»¿äº†é›ª,æ¸…ç†å®ƒæµªè²»äº†æ™‚é–“ã€‚(æ™‚é–“+1 / ç†æ™º+5)";}}, {txt:"ç„¡è¦–", act:()=>{player.stats.sani-=10; return "é€™æ˜¯ä¸ç¥¥ä¹‹å…†ã€‚(ç†æ™º-10)";}}] }, 
            { id: "z1_serac", title: "å†°å¡”å´©å¡Œ", text: "å·¨å¤§çš„å†°æŸ±åœ¨ä½ èº«æ—ç™¼å‡ºé›·é³´èˆ¬çš„æ–·è£‚è²!", opts: [{ txt: "ç·Šæ€¥é–ƒé¿", act: () => { player.stats.stam -= 25; return "ä½ ç‹¼ç‹½åœ°æ»¾å‘ä¸€é‚Šã€‚(é«”åŠ›-25)"; }}, { txt: "å‘†ä½ä¸å‹•", act: () => { if(player.stats.sani > 50) return "é‹æ°£å¥½,å†°å¡Šæ²’ç ¸ä¸­ã€‚(ç„¡äº‹)"; else { player.stats.sani -= 40; return "ä½ è¢«å·¨éŸ¿åš‡å£äº†ã€‚(ç†æ™º-40)"; }}}] }, 
            { id: "z1_ladder", title: "æ¢¯å­ä¸Šçš„ææ‡¼", text: "å‰é¢çš„ç™»å±±è€…åœ¨è·¨è¶Šè£‚ç¸«çš„é‹æ¢¯ä¸Šåœä½äº†,æ¸¾èº«é¡«æŠ–æ“‹ä½äº†è·¯ã€‚", opts: [{txt:"å¤§è²é¼“å‹µä»–", act:()=>{player.stats.stam-=10; player.stats.sani+=10; return "ä½ å–Šç ´äº†å–‰åš¨çµ¦ä»–æ‰“æ°£ã€‚ä»–çµ‚æ–¼å‹•äº†ã€‚(é«”åŠ›-10 / ç†æ™º+10)";}}, {txt:"å‚¬ä¿ƒæ–½å£“", act:()=>{player.stats.sani-=5; return "ä½ æ†¤æ€’åœ°å¼å«ã€‚ä»–é©šæ…Œå¤±æªåœ°çˆ¬éå»äº†,ä½†çœ¼ç¥å……æ»¿æ€¨æ¨ã€‚(ç†æ™º-5)";}}] }, 
            { id: "z1_song", title: "å†°æ²³çš„æ­Œè²", text: "æ·±è—è‰²çš„å†°å±¤æ·±è™•å‚³ä¾†ä½æ²‰ã€æ‰­æ›²çš„å‘»åŸè²èˆ‡çˆ†è£‚è²ã€‚", opts: [{txt:"éœå¿ƒè†è½", act:()=>{player.stats.sani+=15; player.stepInDay+=2; return "ä½ æ„Ÿå—åˆ°äº†å¤§è‡ªç„¶çš„åŠ›é‡,é€™ç¨®ææ‡¼æ„Ÿåè€Œè®“ä½ è¦ºå¾—é‡‹ç„¶ã€‚(ç†æ™º+15 / æ™‚é–“+2)";}}, {txt:"å¿«é€Ÿé›¢é–‹", act:()=>{player.stats.stam-=10; return "é€™ç¨®è²éŸ³è½èµ·ä¾†åƒæ˜¯åœ°ç„çš„é–‹é–€è²,ä½ åªæƒ³é€ƒé›¢ã€‚(é«”åŠ›-10)";}}] },
            // æ–°å¢äº‹ä»¶
            { id: "z1_puja", title: "æ™®è¿¦å„€å¼", text: "è·¯éä¸€å€‹é›ªå·´äººæ­å»ºçš„ç¥­å£‡,äº”è‰²ç¶“å¹¡åœ¨é¢¨ä¸­çµçµä½œéŸ¿,ç©ºæ°£ä¸­é£„è‘—ç‡ƒç‡’æ¾æçš„é¦™å‘³ã€‚", opts: [{txt:"æ’’ç±³ç¥ˆç¦±", act:()=>{player.stats.sani+=25; player.stepInDay+=2; return "ä½ åœä¸‹ä¾†,å­¸è‘—é›ªå·´äººçš„æ¨£å­æ’’äº†ä¸€æŠŠç±³ã€‚å¿ƒéˆå¾—åˆ°äº†æ¥µå¤§çš„å¹³éœ,ææ‡¼æ„Ÿæ¶ˆé€€äº†ã€‚(ç†æ™º+25 / æ™‚é–“+2)";}}, {txt:"é èº¬å¾Œé›¢é–‹", act:()=>{player.stats.sani+=10; return "ä½ ç°¡å–®è‡´æ„å¾Œç¹¼çºŒè¶•è·¯ã€‚é›–ç„¶æ²’æœ‰é§è¶³,ä½†ä½ æ„Ÿè¦ºè‡ªå·±ä¸å†æ˜¯è¢«å±±æ’æ–¥çš„å…¥ä¾µè€…ã€‚(ç†æ™º+10)";}}] },
            { id: "z1_porter", title: "å—å›°çš„èƒŒå¤«", text: "ä¸€åå¹´è¼•çš„èƒŒå¤«èƒŒè‘—å·¨å¤§çš„ç‰©è³‡åŒ…,ä¸€åªè…³å¡åœ¨äº†å†°è£‚ç¸«é‚Šç·£,æ­£åœ¨æ™æ‰ã€‚å‘¨åœæ²’æœ‰å…¶ä»–äººã€‚", opts: [{txt:"ä¼¸å‡ºæ´æ‰‹", act:()=>{player.stats.stam-=20; player.stats.sani+=30; return "ä½ ç”¨åŠ›æ‹‰äº†ä»–ä¸€æŠŠã€‚ä»–é›™æ‰‹åˆåé€£è²é“è¬ã€ŒThuji cheã€,é‚£çœŸèª çš„ç¬‘å®¹è®“ä½ è¦ºå¾—é€™è¶Ÿæ—…ç¨‹æœ‰äº†æ„ç¾©ã€‚(é«”åŠ›-20 / ç†æ™º+30)";}}, {txt:"å†·æ¼ é€šé", act:()=>{player.stats.sani-=30; return "ä½ å‡è£æ²’çœ‹è¦‹ç¹äº†éå»ã€‚èº«å¾Œå‚³ä¾†çš„æ™æ‰è²åƒåˆºä¸€æ¨£æ‰åœ¨ä½ çš„è‰¯å¿ƒä¸Šã€‚(ç†æ™º-30)";}}] }
        ],
[ 
            { id: "z2_dehyd", title: "è„«æ°´å±æ©Ÿ", text: "é…·ç†±è®“ä½ å¤§é‡å‡ºæ±—,ä½ çš„å°¿æ¶²è®Šæˆäº†æ·±è¤è‰²ã€‚", opts:[{txt:"ç‡’é›ªåŒ–æ°´", act:()=>{ if(player.inventory['fuel']>0){player.inventory['fuel']--; player.stepInDay+=3; player.stats.stam+=20; return "å–åˆ°äº†ç†±æ°´,é«”åŠ›æ¢å¾©ã€‚(ç‡ƒæ–™-1 / é«”åŠ›+20)";} else return "æ²’æœ‰ç‡ƒæ–™!ä½ ç™½å¿™ä¸€å ´ã€‚(ç„¡æ•ˆæœ)";}}, {txt:"å«ä¸€å£é›ª", act:()=>{player.stats.temp-=5; player.stats.stam-=5; return "å¤§å¿Œ!å£è…”ç†±é‡æµå¤±ã€‚(é«”æº«-5)";}}] }, 
            { id: "z2_maze", title: "å†°è£‚ç¸«è¿·å®®", text: "å‰æ–¹å‡ºç¾å¯†é›†çš„è£‚ç¸«å¸¶,è·¯ç¹©è¢«åŸ‹æ²’äº†ã€‚", opts:[{txt:"å°‹æ‰¾è·¯ç¹©", act:()=>{player.stepInDay+=4; player.stats.stam-=10; return "èŠ±äº†å¾ˆä¹…æ™‚é–“æŒ–æ˜ã€‚(æ™‚é–“+4 / é«”åŠ›-10)";}}, {txt:"ç›´æ¥è·³èº", act:()=>{player.stats.stam-=25; return "é€£çºŒè·³èºæ¥µåº¦æ¶ˆè€—é«”èƒ½ã€‚(é«”åŠ›-25)";}}] }, 
            { id: "z2_blind", title: "é›ªç›²", text: "ç‚ºäº†æ“¦æ±—ä½ æš«æ™‚æ‘˜ä¸‹äº†è­·ç›®é¡,å¼·çƒˆçš„ç´«å¤–ç·šè®“ä½ é›™çœ¼åˆºç—›ã€‚", opts: [{ txt: "åœä¸‹å†·æ•·", act: () => { player.stepInDay += 5; player.stats.temp -= 5; return "è¦–åŠ›æ¢å¾©äº†,ä½†æµªè²»äº†æ™‚é–“ã€‚(æ™‚é–“+5 / é«”æº«-5)"; }}, { txt: "æ‘¸é»‘å‰é€²", act: () => { player.stats.sani -= 30; return "ä½ åœ¨é»‘æš—ä¸­è·Œè·Œæ’æ’ã€‚(ç†æ™º-30)"; } } ] }, 
            { id: "z2_tea", title: "ç†±èŒ¶çš„é‚€è«‹", text: "ä¸€ä½é›ªå·´åš®å°åœ¨è·¯é‚Šç‡’æ°´,ç¡¬çµ¦ä½ ä¸€æ¯åŠ äº†ç³–çš„ç´…èŒ¶ã€‚", opts: [{txt:"æ¥å—å¥½æ„", act:()=>{player.stats.stam+=10; player.stats.sani+=10; player.stepInDay+=2; return "æº«æš–çš„ç³–æ°´æ»‹æ½¤äº†å–‰åš¨,çŸ­æš«çš„ç¤¾äº¤è®“ä½ æ”¾é¬†ã€‚(é«”åŠ›+10 / ç†æ™º+10 / æ™‚é–“+2)";}}, {txt:"å©‰æ‹’è¶•è·¯", act:()=>{return "ä½ æŒ‡äº†æŒ‡æ‰‹éŒ¶æ‹’çµ•äº†ã€‚ä¿æŒç¯€å¥å¾ˆé‡è¦ã€‚";}}] }, 
            { id: "z2_silence", title: "ç™½è‰²å¯‚éœ", text: "é¢¨çªç„¶åœäº†ã€‚å››å‘¨æ˜¯åˆºçœ¼çš„ç™½è‰²é›ªåŸ,å®‰éœå¾—å¯æ€•ã€‚", opts: [{txt:"ç’°é¡§ç¾¤å±±", act:()=>{player.stats.sani+=20; player.stepInDay+=1; return "åŠªå­å³°å’Œæ´›å­å³°çš„é€£ç·šå£¯éº—ç„¡æ¯”ã€‚ä½ æ‹äº†ä¸€å¼µç…§ç‰‡ã€‚(ç†æ™º+20 / æ™‚é–“+1)";}}, {txt:"ä½é ­çœ‹è·¯", act:()=>{player.stats.sani-=5; return "ä½ çœ‹éƒ½ä¸æ•¢çœ‹,ç”Ÿæ€•è¢«é€™å·¨å¤§çš„ç©ºæ› æ„Ÿåå™¬ã€‚(ç†æ™º-5)";}}] },
            // æ–°å¢äº‹ä»¶
            { id: "z2_lostfound", title: "å‰äººéºç‰©", text: "ä½ è¸¢åˆ°äº†ä¸€å€‹è¢«é›ªåŸ‹ä½çš„é˜²æ°´è¢‹,çœ‹èµ·ä¾†æ˜¯å»å¹´çš„éšŠä¼ç•™ä¸‹çš„ã€‚", opts: [{txt:"æ‰“é–‹çœ‹çœ‹", act:()=>{ if(Math.random()>0.6) { player.inventory['food'] = (player.inventory['food']||0)+1; return "é‹æ°£ä¸éŒ¯!è£¡é¢æœ‰ä¸€åŒ…æ²’éæœŸçš„å£ç³§ã€‚(ç²å¾—å£ç³§)"; } else { player.stats.sani-=10; return "è£¡é¢åªæœ‰åƒåœ¾å’Œç ´æçš„è¥ªå­,ä»¤äººå¤±æœ›ã€‚(ç†æ™º-10)"; }}}, {txt:"ç„¡è¦–", act:()=>{ return "å¤šé¤˜çš„è² é‡æœƒæ®ºæ­»ä½ ã€‚";}}] },
            { id: "z2_microwave", title: "å¾®æ³¢çˆæ•ˆæ‡‰", text: "å±±è°·åœ°å½¢èšé›†äº†é™½å…‰,æº«åº¦ç†±å¾—åƒæ¡‘æ‹¿æˆ¿,ä½ çš„çš®è†šé–‹å§‹åˆºç—›ã€‚", opts: [{txt:"åœä¸‹å¡—é˜²æ›¬éœœ", act:()=>{player.stepInDay+=2; player.stats.sani+=5; return "ä½ ä»”ç´°ä¿è­·äº†çš®è†š,é›–ç„¶èŠ±è²»äº†æ™‚é–“,ä½†å¿ƒè£¡è¸å¯¦äº†ã€‚(æ™‚é–“+2 / ç†æ™º+5)";}}, {txt:"å¿è€", act:()=>{player.stats.sani-=25; return "æ™šä¸Šä½ çš„è‡‰å°‡æœƒè„«çš®ä¸¦åŠ‡ç—›,é€™ç¨®ç—›è‹¦æœƒæŠ˜ç£¨ä½ çš„ç²¾ç¥ã€‚(ç†æ™º-25)";}}] }
        ],
        [ 
            { id: "z3_ice", title: "ç¢å†°é›¨", text: "ä¸Šæ–¹æ”€ç™»è€…çš„å†°çˆªè¸¢è½äº†å¤§é‡ç¢å†°,åƒé›¨é»ä¸€æ¨£è½ä¸‹ã€‚", opts:[{txt:"ä½é ­ç¡¬æ‰›", act:()=>{return "è­·ç›®é¡è¢«ç ¸è£‚äº†ä¸€æ¢ç¸«,è¦–é‡å—æã€‚";}}, {txt:"å·¦å³é–ƒé¿", act:()=>{player.stats.stam-=20; return "åœ¨é«˜å¡ä¸Šé »ç¹ç§»å‹•éå¸¸ç´¯ã€‚(é«”åŠ›-20)";}}] }, 
            { id: "z3_drop", title: "æ‰‹å¥—æ»‘è½", text: "ä½ åœ¨æ›æ‰£ç’°æ™‚,ä¸€éš»æ‰‹å¥—æ»‘è½,æ›åœ¨äº†ä¸‹æ–¹ 5 ç±³è™•ã€‚", opts:[{txt:"çˆ¬ä¸‹å»æ’¿", act:()=>{ if(Math.random()>0.5){player.stats.sani+=10; return "æ’¿å›ä¾†äº†!(ç†æ™º+10)";} else {player.stats.stam-=30; return "æ²’æ’¿åˆ°,é‚„æµªè²»äº†åŠ›æ°£ã€‚(é«”åŠ›-30)";} }}, {txt:"æ”¾æ£„", act:()=>{player.stats.temp-=20; player.stats.sani-=20; return "æ„å‘³è‘—å‡å‚·é¢¨éšªã€‚(é«”æº«-20 / ç†æ™º-20)";}}] }, 
            { id: "z3_rock", title: "è½çŸ³", text: "é»ƒå¸¶å²©å±¤çš„çŸ³é ­é¬†å‹•æ»¾è½ã€‚", opts: [{ txt: "ä¾é é ­ç›”", act: () => { if(Math.random()>0.5) return "çŸ³é ­ç ¸åœ¨èƒŒåŒ…ä¸Š,å®‰å…¨ã€‚"; else { player.stats.stam -= 20; return "çŸ³é ­ç ¸ä¸­è‚©è†€!(é«”åŠ›-20)"; }}}] }, 
            { id: "z3_tangle", title: "ç³¾çºçš„è·¯ç¹©", text: "ä½ å’Œä¸€åä¸‹æ’¤çš„ç™»å±±è€…çš„å®‰å…¨æ‰£ç¹©ç³¾çºåœ¨äº†ä¸€èµ·,æ‡¸æ›åœ¨å†°å¡ä¸Šã€‚", opts: [{txt:"è€å¿ƒè§£é–‹", act:()=>{player.stats.temp-=10; return "ä½ è„«ä¸‹æ‰‹å¥—,æ‰‹æŒ‡å‡å¾—ç™¼ç—›,ä½†çµ‚æ–¼è§£é–‹äº†ç¹©çµã€‚(é«”æº«-10)";}}, {txt:"å‰²æ–·å°æ–¹", act:()=>{player.stats.sani-=30; return "ä½ å‰²æ–·äº†ä»–çš„ä¸€æ ¹è¼”åŠ©ç¹©ã€‚ä»–é©šæåœ°çœ‹è‘—ä½ ã€‚(ç†æ™º-30)";}}] }, 
            { id: "z3_gaze", title: "æ·±æ·µå‡è¦–", text: "ä½ æ›åœ¨å†°å£ä¸Šä¼‘æ¯,å›é ­æœ›å‘èº«å¾Œåƒç±³çš„è½å·®ã€‚", opts: [{txt:"ç›´è¦–æ·±æ·µ", act:()=>{player.stats.sani-=20; return "ä¸€ç¨®æƒ³è¦è·³ä¸‹å»çš„è¡å‹•è¥²ä¾†,ä½ åš‡å‡ºä¸€èº«å†·æ±—ã€‚(ç†æ™º-20)";}}, {txt:"ç·Šè²¼å†°å£", act:()=>{player.stats.stam-=5; return "ä½ æŠŠè‡‰è²¼åœ¨å†°é¢ä¸Š,ä¸æ•¢å›é ­,ç›´åˆ°å¿ƒè·³å¹³å¾©ã€‚(é«”åŠ›-5)";}}] },
            // æ–°å¢äº‹ä»¶
            { id: "z3_flow", title: "å®Œç¾çš„ç¯€å¥", text: "æ©Ÿæ¢°å¼çš„æ”€ç™»å‹•ä½œè®“ä½ é€²å…¥äº†ä¸€ç¨®å¥‡å¦™çš„ææƒšç‹€æ…‹ã€‚ä½ ä¸è¦ºå¾—ç´¯,ä¹Ÿä¸è¦ºå¾—å†·ã€‚", opts: [{txt:"ç¶­æŒé€™å€‹ç¯€å¥", act:()=>{player.stats.stam+=15; player.stats.sani+=15; return "ä½ åœ¨é€™ç¨®ç¦ªå®šçš„ç‹€æ…‹ä¸­æ”€ç™»äº†ä¸€å°æ™‚,æ„Ÿè¦ºèº«é«”æ¯”å‡ºç™¼æ™‚é‚„è¦è¼•ç›ˆã€‚(é«”åŠ›+15 / ç†æ™º+15)";}}, {txt:"åˆ©ç”¨ç‹€æ…‹åŠ é€Ÿ", act:()=>{player.progress+=3; player.stats.stam-=5; return "ä½ è¶è‘—ç‹€æ…‹æ¥µä½³,åŠ å¿«äº†è…³æ­¥,è¶…è¶Šäº†å…©çµ„ç·©æ…¢çš„éšŠä¼ã€‚(é€²åº¦+3 / é«”åŠ›-5)";}}] },
            { id: "z3_crampon", title: "å†°çˆªé¬†å‹•", text: "åœ¨70åº¦çš„è—å†°å¡ä¸Š,ä½ çš„å³è…³å†°çˆªç¶å¸¶é¬†äº†,éš¨æ™‚å¯èƒ½è„«è½ã€‚", opts: [{txt:"å†’éšªé‡æ–°ç¶", act:()=>{ if(Math.random()>0.6) { player.stats.stam-=10; return "ä½ åœ¨æ¥µåº¦å±éšªçš„å§¿å‹¢ä¸‹ç¶å¥½äº†å®ƒã€‚(é«”åŠ›-10)"; } else { player.stats.stam-=40; player.deathRisk+=15; return "ä½ æ‰‹æ»‘äº†!æ»‘å¢œäº†å¹¾ç±³æ‰è¢«å®‰å…¨ç¹©æ‹‰ä½,é­‚é£›é­„æ•£ã€‚(é«”åŠ›-40 / æ­»äº¡ç‡+15%)"; }}}, {txt:"å‹‰å¼·æ”¯æ’", act:()=>{player.stats.stam-=20; return "ä½ æ›´å¤šåœ°ä¾é æ‰‹è‡‚åŠ›é‡æ‹‰ä¸Šå‡å™¨,é›™è‡‚é…¸ç—›ç„¡æ¯”ã€‚(é«”åŠ›-20)";}}] }
        ],
[ 
            { id: "z4_zip", title: "å‡çµçš„æ‹‰éŠ", text: "ä½ æƒ³æ‹¿æ°´å–,ä½†é€£é«”è¡£çš„æ‹‰éŠå®Œå…¨å‡æ­»,æ‹‰ä¸é–‹ã€‚", opts:[{txt:"ç”¨è »åŠ›æ‹‰", act:()=>{player.stats.temp-=10; return "æ‹‰éŠå£äº†,å†·é¢¨ç›´çŒã€‚(é«”æº«æŒçºŒä¸‹é™)";}}, {txt:"æ”¾æ£„å–æ°´", act:()=>{player.stats.hung-=20; player.stats.sani-=20; return "å£æ¸´é›£è€ã€‚(é£½é£Ÿåº¦-20 / ç†æ™º-20)";}}] }, 
            { id: "z4_oldoxy", title: "éºæ£„çš„æ°§æ°£ç“¶", text: "é›ªåœ°è£¡åŸ‹è‘—åŠç“¶æ°§æ°£,æ˜¯å»å¹´éšŠä¼ç•™ä¸‹çš„ã€‚", opts:[{txt:"æ›´æ›ä½¿ç”¨", act:()=>{ if(Math.random()>0.7){ player.stats.stam+=30; player.stats.sani+=15; return "é‹æ°£å¥½!è£¡é¢é‚„æœ‰æ°§æ°£ã€‚(é«”åŠ›+30 / ç†æ™º+15)";} else { return "æ˜¯å£çš„,ä»€éº¼éƒ½æ²’æœ‰ç™¼ç”Ÿã€‚(ç„¡æ•ˆæœ)";} }}, {txt:"ä¸å†’éšª", act:()=>{return "å®‰å…¨ä½†éºæ†¾ã€‚";}}] }, 
            { id: "z4_dying", title: "å‚æ­»æ±‚æ•‘", text: "è·¯é‚Šåè‘—ä¸€å€‹ç€•æ­»çš„ç™»å±±è€…:ã€Œæ°§æ°£...çµ¦æˆ‘ä¸€é»æ°§æ°£...ã€", opts: [{ txt: "åˆ†çµ¦ä»–æ°§æ°£", cond: (p)=>p.inventory['oxygen']>0, act: () => { player.inventory['oxygen']--; player.stats.sani += 40; return "ä½ çµ¦äº†ä»–æ°£ç“¶ã€‚ä½ å®ˆä½äº†äººæ€§ã€‚(å¤±å»æ°§æ°£ / ç†æ™º+40)"; }}, { txt: "ç„¡è¦–", act: () => { player.stats.sani -= 40; return "8000ç±³ä»¥ä¸Šç„¡é“å¾·ã€‚(ç†æ™º-40)"; }}, { txt: "æ‹¿èµ°ç‰©è³‡", cond: (p)=>p.stats.sani<30, act: () => { player.inventory['food']=(player.inventory['food']||0)+1; player.stats.sani -= 100; return "ä½ æ‹¿èµ°äº†ä»–çš„å£ç³§ã€‚(ç²å¾—å£ç³§ / ç†æ™º-100)"; }}] }, 
            { id: "z4_sitter", title: "åè‘—çš„äºº", text: "è·¯é‚Šåè‘—ä¸€å€‹äºº,å…œå¸½è“‹ä½äº†è‡‰,ä¸€å‹•ä¸å‹•ã€‚", opts: [{txt:"ä¸Šå‰æ‹æ‹ä»–", act:()=>{player.stats.sani-=25; return "ä»–æ˜¯ç¡¬çš„ã€‚ä½ è§¸æ‘¸åˆ°äº†æ­»äº¡ã€‚(ç†æ™º-25)";}}, {txt:"ç¹é“è€Œè¡Œ", act:()=>{player.stats.stam-=5; return "ä½ å‡è£ä»–åªæ˜¯åœ¨ä¼‘æ¯,ä½è‘—é ­å¿«é€Ÿé€šéã€‚(é«”åŠ›-5)";}}] }, 
            { id: "z4_stars", title: "ç™½æ™æ˜Ÿè¾°", text: "å¤©ç©ºå‘ˆç¾å‡ºæ·±é‚ƒçš„é»‘ç´«è‰²,å³ä½¿æ˜¯æ­£åˆ,ä½ ä¹Ÿä¾ç¨€çœ‹åˆ°æ˜Ÿæ˜Ÿã€‚", opts: [{txt:"æŠ¬é ­ä»°æœ›", act:()=>{player.stats.sani+=10; player.stats.temp-=5; return "ä½ æ„Ÿè¦ºè‡ªå·±æ­£åœ¨å¤ªç©ºä¸­æ¼«æ­¥ã€‚(ç†æ™º+10 / é«”æº«-5)";}}, {txt:"æª¢æŸ¥æ°§æ°£", act:()=>{return "ä½ ä¸é—œå¿ƒæ˜Ÿæ˜Ÿ,ä½ åªé—œå¿ƒé‚„èƒ½æ´»å¤šä¹…ã€‚";}}] },
            // æ–°å¢äº‹ä»¶
            { id: "z4_ghosttent", title: "å¹½éˆå¸³ç¯·", text: "ç‹‚é¢¨ä¸­ä½ çœ‹è¦‹å‰æ–¹æœ‰ä¸€å€‹æ®˜ç ´çš„å¸³ç¯·,ä¼¼ä¹é‚„èƒ½å‹‰å¼·é¿é¢¨ã€‚", opts: [{txt:"èº²åœ¨æ®˜éª¸å¾Œå–˜æ¯", act:()=>{player.stats.temp+=10; player.stepInDay+=2; return "èŠå‹æ–¼ç„¡,é€™è£¡çš„é¢¨é€Ÿç¨å¾®å°äº†ä¸€é»,ä½ æ„Ÿè¦ºèº«é«”å›æš–äº†äº›è¨±ã€‚(é«”æº«+10 / æ™‚é–“+2)";}}, {txt:"æœç´¢å¸³ç¯·å…§éƒ¨", act:()=>{ if(Math.random()>0.7) { player.stats.stam+=20; player.stats.sani+=10; return "ä½ åœ¨è§’è½ç™¼ç¾äº†åŠç½å‰©ä¸‹çš„æ°§æ°£!å¸äº†å¹¾å£å¾Œç²¾ç¥å¤§æŒ¯ã€‚(é«”åŠ›+20 / ç†æ™º+10)"; } else { player.stats.sani-=35; return "è£¡é¢åªæœ‰ä¸€å…·å‡åƒµçš„å±é«”,ä½ å°–å«è‘—é€€äº†å‡ºä¾†ã€‚(ç†æ™º-35)"; }}}] },
            { id: "z4_frozenmask", title: "é¢ç½©çµå†°", text: "ä½ çš„æ°§æ°£é¢ç½©å‡ºæ°£å­”è¢«å‘¼å‡ºçš„æ°´æ°£å‡ä½äº†,å‘¼å¸è®Šå¾—æ¥µå…¶å›°é›£ã€‚", opts: [{txt:"åœä¸‹æ¸…ç†å†°å¡Š", act:()=>{player.stepInDay+=2; player.stats.temp-=15; return "ä½ æ‘˜ä¸‹æ‰‹å¥—æ‘³æ‰äº†å†°å¡Šã€‚æ‰‹å‡åƒµäº†,ä½†çµ‚æ–¼èƒ½é †æš¢å‘¼å¸äº†ã€‚(æ™‚é–“+2 / é«”æº«-15)";}}, {txt:"ç”¨åŠ›å¸æ°£", act:()=>{player.stats.stam-=25; return "æ¯ä¸€å£æ°£éƒ½åƒåœ¨æ‹‰é¢¨ç®±,è‚ºéƒ¨åŠ‡çƒˆç‡ƒç‡’,æ¥µåº¦æ¶ˆè€—é«”åŠ›ã€‚(é«”åŠ›-25)";}}] }
        ],            [
{ id: "z5_boot", title: "å±é«”è·¯æ¨™", text: "ä½ å¿…é ˆè·¨éé‚£å…·è‘—åçš„ã€Œç¶ é´å­ã€éºé«”ã€‚", opts:[{txt:"è·¨éå»", act:()=>{player.stats.sani-=40; return "è¿‘è·é›¢æ¥è§¸æ­»äº¡ã€‚(ç†æ™º-40)";}}, {txt:"ç¹å¤–å´èµ°", act:()=>{player.stats.stam-=20; player.stats.sani-=10; return "è§£é–‹è·¯ç¹©ç¹è·¯,è…³ä¸‹å°±æ˜¯æ‡¸å´–ã€‚(é«”åŠ›-20)";}}] },
{ id: "z5_queue", title: "ç™»é ‚æ’éšŠ", text: "å‰é¢çš„äººå‹•ä½œæ¥µæ…¢,æ“‹ä½äº†å”¯ä¸€çš„è·¯ã€‚", opts:[{txt:"æ¨ä»–ä¸€æŠŠ", act:()=>{player.stats.sani-=60; return "ä½ ç‚ºäº†ç”Ÿå­˜è®Šå¾—æ®˜å¿ã€‚(ç†æ™º-60)";}}, {txt:"å¹«ä»–ä¸€æŠŠ", act:()=>{player.stats.stam-=40; return "ä½ æ¨è‘—ä»–èµ°,è€—ç›¡äº†åŠ›æ°£ã€‚(é«”åŠ›-40)";}}] },
{ id: "z5_jam", title: "å¤§å¡è»Š", text: "å¸Œæ‹‰é‡Œå°éšä¸Šæœ‰äººå¡ä½äº†ã€‚", opts: [{ txt: "åŸåœ°ç­‰å¾…", act: () => { player.stats.temp -= 20; player.stats.stam -= 10; return "ä½ åœ¨å¯’é¢¨ä¸­ç«™äº†åŠå°æ™‚ã€‚(é«”æº«-20 / é«”åŠ›-10)"; }}, { txt: "è§£é–è¶…è»Š", act: () => { if(player.gear.includes('crampons')) { player.stats.stam -= 30; return "æ¥µåº¦å±éšª,å¹¸å¥½æœ‰å†°çˆªã€‚(é«”åŠ›-30)"; } else { player.stats.stam = 0; player.stats.temp = 0; return "æ²’æœ‰å†°çˆª,ä½ è…³ä¸‹ä¸€æ»‘...(æ­»äº¡åˆ¤å®š)"; }}}] },
{ id: "z5_photo", title: "ç™»é ‚åˆç…§", text: "æœ‰äººæ‹‰ä½ä½ ,æƒ³åœ¨ç‹¹çª„çš„å±±è„Šä¸Šåˆå½±ç•™å¿µã€‚", opts: [{txt:"é…åˆæ‹ç…§", act:()=>{player.stats.temp-=20; player.stats.sani+=20; return "ä½ æ‘˜ä¸‹æ‰‹å¥—æ¯”äº†å€‹è®šã€‚å¹¾ç§’é˜,æ‰‹æŒ‡å¤±å»äº†çŸ¥è¦ºã€‚(é«”æº«-20 / ç†æ™º+20)";}}, {txt:"æ¨é–‹ä»–", act:()=>{player.stats.stam-=5; return "åœ¨é€™è£¡æ¯ä¸€ç§’éƒ½æ˜¯å‘½,ä½ æ²’å¿ƒæƒ…æç¤¾äº¤ã€‚(é«”åŠ›-5)";}}] },

// æ–°å¢äº‹ä»¶
{ id: "z5_dawn", title: "ä¸–ç•Œçš„é»æ˜", text: "é‡‘è‰²çš„é™½å…‰ç¬é–“åˆºç ´é›²å±¤,å·¨å¤§çš„é‡‘å­—å¡”å½¢é™°å½±æŠ•å°„åœ¨ä¸‹æ–¹çš„é›²æµ·ä¹‹ä¸Šã€‚", opts: [{txt:"éœ‡æ’¼æ³¨è¦–", act:()=>{player.stats.sani = 100; return "é€™å°±æ˜¯ä¸–ç•Œä¹‹å·”çš„è­‰æ˜ã€‚é€™ä¸€åˆ»çš„å£¯éº—è¶³ä»¥æŠµæ¶ˆæ‰€æœ‰çš„ç—›è‹¦ã€‚(ç†æ™ºå›æ»¿)";}}, {txt:"å°ˆæ³¨è…³ä¸‹", act:()=>{player.progress+=1; return "ä½ åªçœ‹è‘—è…³ä¸‹çš„å²©çŸ³ã€‚æ´»è‘—å›å®¶æ¯”çœ‹é¢¨æ™¯æ›´é‡è¦ã€‚(é€²åº¦+1)";}}] },
{ id: "z5_silentplea", title: "ç„¡è¨€çš„è«‹æ±‚", text: "è·¯é‚Šåè‘—ä¸€å€‹æ„è­˜æ¨¡ç³Šçš„ç™»å±±è€…,é¢ç½©æ›åœ¨ä¸‹å·´ä¸Š,çœ¼ç¥æ¸™æ•£ã€‚çœ‹åˆ°ä½ ç¶“é,ä»–è‰±é›£åœ°æŠ¬èµ·æ‰‹,ç™¼å‡ºå˜¶å•çš„è²éŸ³ä¹è¨ç‰©è³‡ã€‚", opts: [
{ txt: "åˆ†çµ¦ä»–å£ç³§", cond: (p)=>p.inventory['food']>0, act: () => { player.inventory['food']--; if(player.inventory['food']===0) delete player.inventory['food']; player.stats.sani += 50; return "ä½ æŠŠçè²´çš„èƒ½é‡æ£’å¡é€²ä»–æ‰‹è£¡ã€‚é€™æ•‘ä¸äº†ä»–çš„å‘½,ä½†æ•‘è´–äº†ä½ çš„äººæ€§ã€‚(å¤±å»å£ç³§ / ç†æ™º+50)"; }},
{ txt: "åˆ†çµ¦ä»–ç‡ƒæ–™", cond: (p)=>p.inventory['fuel']>0, act: () => { player.inventory['fuel']--; if(player.inventory['fuel']===0) delete player.inventory['fuel']; player.stats.sani += 50; return "ä½ æŠŠå›ºé«”ç‡ƒæ–™éçµ¦ä»–ã€‚æœ‰äº†é€™å€‹ä»–å°±èƒ½åŒ–é›ªå–æ°´ã€‚å“ªæ€•åªæ˜¯å¾®å¼±çš„å¸Œæœ›,ä¹Ÿæ¯”çµ•æœ›å¥½ã€‚(å¤±å»ç‡ƒæ–™ / ç†æ™º+50)"; }},
{ txt: "ç„¡è¦–", act: () => { player.stats.sani -= 40; return "åœ¨8000ç±³ä»¥ä¸Š,é“å¾·æ˜¯ä¸€ç¨®å¥¢ä¾ˆå“ã€‚ä½ ç¡¬èµ·å¿ƒè…¸è·¨éäº†ä»–çš„è…¿,èƒŒå¾Œå‚³ä¾†å¾®å¼±çš„å˜†æ¯è²ã€‚(ç†æ™º-40)"; }}
] }
]
]
};

    /* --- GAME STATE --- */
    let player = {
        money: 13000, 
        inventory: {}, 
        gear: [],      
        stats: { stam: 100, temp: 100, hung: 100, sani: 100 },
        minStats: { stam: 100, temp: 100, hung: 100, sani: 100 }, 
        progress: 0.0,
        maxProgress: 0.0, 
        stepInDay: 0, 
        dayCount: 1, 
        totalSteps: 0, 
        isNight: false,
        isDescending: false, 
        blizzard: { active: false, timer: 0 }, 
        summitAborted: false, 
        locName: "æ˜†å¸ƒå†°å·",
        eventHistory: [],
        hypoxiaMode: false,
        deathRisk: 0,
        maxDeathRisk: 0,
        hasSummited: false,
        summitedWithoutO2: false
    };

    /* --- INITIALIZATION --- */
    function initShop() {
        const container = document.getElementById('shop-list');
        container.innerHTML = ''; 
        ITEMS.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item-card';
            let actionHtml = `
                <button class="btn-qty" onclick="modifyItem('${item.id}', -1)">-</button>
                <span id="cnt-${item.id}" class="qty-display">0</span>
                <button class="btn-qty" onclick="modifyItem('${item.id}', 1)">+</button>
            `;
            div.innerHTML = `
                <div class="item-info">
                    <div style="font-weight:bold; color:#fff">${item.name}</div>
                    <div style="font-size:0.8em; color:#888;">$${item.price} | ${item.weight}kg</div>
                    <div style="font-size:0.8em; color:#aaa;">${item.desc}</div>
                </div>
                <div class="item-actions">${actionHtml}</div>
            `;
            container.appendChild(div);
        });
        updateShopUI();
        
        // Initial Background
        setBg('title');
    }

    /* --- NAVIGATION --- */
    function enterDifficultySelection() {
        document.getElementById('title-screen').classList.remove('active-screen');
        document.getElementById('difficulty-screen').classList.add('active-screen');
    }

    function selectDifficulty(diff) {
        currentDiff = diff;
        const config = DIFFICULTIES[diff];
        
        // Apply settings
        player.money = config.money;
        
        // Refresh Shop UI to show correct money
        updateShopUI();
        
        // Move to Shop
        document.getElementById('difficulty-screen').classList.remove('active-screen');
        document.getElementById('shop-screen').classList.add('active-screen');
        setBg('shop');
    }

    function startGame() {
        if (getWeight() > 35) return alert("è¶…é‡ç„¡æ³•å‡ºç™¼ï¼");
        const hasCoat = player.gear.some(id => ITEMS.find(i=>i.id===id).category==='coat');
        if(!hasCoat && !confirm("ä½ æ²’æœ‰è²·å¤–å¥—ï¼é€™å¹¾ä¹ç­‰æ–¼è‡ªæ®ºã€‚ç¢ºå®šè¦å‡ºç™¼å—ï¼Ÿ")) return;

        document.getElementById('shop-screen').classList.remove('active-screen');
        document.getElementById('game-screen').classList.add('active-screen');
        
        log("é å¾é–‹å§‹ã€‚ç›®æ¨™ï¼šç™»é ‚ä¸¦æ´»è‘—å›ä¾†ã€‚", "event");
        updateHUD();
    }

    /* --- SHOP LOGIC --- */
    function modifyItem(id, change) {
        const item = ITEMS.find(i => i.id === id);
        
        if (item.type === 'gear' || item.type === 'tool') {
            if (change > 0) {
                if (player.gear.includes(id)) return; 
                
                if (item.category === 'coat' || item.category === 'bag') {
                    const conflict = ITEMS.find(i => i.category === item.category && player.gear.includes(i.id));
                    if (conflict) {
                        alert(`ä½ å·²ç¶“æ“æœ‰ ${conflict.name}ï¼Œå¿…é ˆå…ˆè³£å‡ºæ‰èƒ½è³¼è²· ${item.name}ã€‚`);
                        return;
                    }
                }

                if (attemptTransaction(item.price, item.weight)) {
                    player.gear.push(id);
                }
            } else {
                if (player.gear.includes(id)) {
                    player.money += item.price;
                    player.gear = player.gear.filter(g => g !== id);
                }
            }
        } 
        else {
            const currentCount = player.inventory[id] || 0;
            if (change > 0) {
                if (attemptTransaction(item.price, item.weight)) player.inventory[id] = currentCount + 1;
            } else if (currentCount > 0) {
                player.money += item.price;
                player.inventory[id] = currentCount - 1;
                if (player.inventory[id] === 0) delete player.inventory[id];
            }
        }
        updateShopUI();
    }

    function attemptTransaction(cost, weight) {
        if (player.money < cost) { alert("è³‡é‡‘ä¸è¶³"); return false; }
        if (getWeight() + weight > 35) { alert("å¤ªé‡äº†"); return false; }
        player.money -= cost;
        return true;
    }

    function getWeight() {
        let w = 0;
        player.gear.forEach(id => w += ITEMS.find(i=>i.id===id).weight);
        for(let id in player.inventory) w += ITEMS.find(i=>i.id===id).weight * player.inventory[id];
        return Math.round(w*10)/10;
    }

    function updateShopUI() {
        document.getElementById('shop-money').innerText = '$'+player.money;
        const w = getWeight();
        const wEl = document.getElementById('shop-weight');
        wEl.innerText = w;
        wEl.style.color = w > 35 ? '#d9534f' : '#ccc';
        
        ITEMS.forEach(item => {
            const cntSpan = document.getElementById('cnt-'+item.id);
            if (item.type === 'gear' || item.type === 'tool') {
                cntSpan.innerText = player.gear.includes(item.id) ? "1" : "0";
            } else {
                cntSpan.innerText = player.inventory[item.id] || 0;
            }
        });
    }

    /* --- ENVIRONMENT FACTORS --- */
    function getEnvFactors() {
        let factors = { climb: { day: 3, night: 8 }, rest:  { day: 10, night: 20 }, desc: "å¯’å†·" };
        if (player.progress >= 60 && player.progress < 80) {
            factors.climb = { day: 4, night: 10 }; factors.rest  = { day: 12, night: 25 }; factors.desc = "åˆºéª¨";
        } 
        else if (player.progress >= 80) {
            factors.climb = { day: 6, night: 15 }; factors.rest  = { day: 15, night: 35 }; factors.desc = "è‡´å‘½"; 
        }
        return factors;
    }

    /* --- LOCATION MAPPING --- */
    function getDetailedLocationName(progress) {
        if (progress >= 100) return "è–æ¯å³°é ‚ (8848m)";
        if (progress >= 96) return "å³°é ‚è·¯è„Š (8800m+)";
        if (progress >= 92) return "å¸Œæ‹‰é‡Œå°éš (8790m)";
        if (progress >= 88) return "å—å³° (8749m)";
        if (progress >= 82) return "é™½å° (8400m)";
        if (progress >= 80) return "C4 å—å³ (7950m)";
        
        if (progress >= 72) return "æ—¥å…§ç“¦å¸Œå¾· (7600m)";
        if (progress >= 65) return "é»ƒå¸¶å²©å±¤ (7400m)";
        if (progress >= 60) return "C3 æ´›å­å£ (7162m)";

        if (progress >= 55) return "å‚ç›´æ¥µé™å†°å£ (7000m)";
        if (progress >= 45) return "è—å†°å¡ (6700m)";
        if (progress >= 40) return "C2 å‰é€²åŸºåœ°ç‡Ÿ (6400m)";

        if (progress >= 35) return "æ´›å­å£åŸºåº• (6200m)";
        if (progress >= 25) return "æ²‰é»˜å±±è°·å¹³åŸ (6000m)";
        if (progress >= 20) return "C1 å†°å·å­¤å³¶ (5943m)";

        if (progress >= 12) return "å†°å·ä¸Šéƒ¨ (5800m)";
        if (progress >= 5) return "çˆ†ç±³èŠ±ç”° (5500m)";
        return "åŸºåœ°ç‡Ÿç¢çŸ³å¡ (5364m)";
    }

    /* --- BACKGROUND SYSTEM --- */
    function setBg(key) {
        // Pre-defined keys
        if (BG_IMAGES[key]) {
            document.body.style.backgroundImage = BG_IMAGES[key];
            return;
        }
        
        // Progress-based logic (0-100)
        let bgKey = 'zone1';
        if (key >= 100) bgKey = 'zone5'; // Summit
        else if (key >= 80) bgKey = 'zone5';
        else if (key >= 60) bgKey = 'zone4';
        else if (key >= 40) bgKey = 'zone3';
        else if (key >= 20) bgKey = 'zone2';
        
        if (player.blizzard.active) bgKey = 'blizzard';
        
        document.body.style.backgroundImage = BG_IMAGES[bgKey];
    }

    /* --- GLOBAL STATS CLAMPING --- */
    function normalizeStats() {
        player.stats.stam = Math.max(0, Math.min(100, player.stats.stam));
        player.stats.temp = Math.max(0, Math.min(100, player.stats.temp));
        player.stats.hung = Math.max(0, Math.min(100, player.stats.hung));
        player.stats.sani = Math.max(0, Math.min(100, player.stats.sani));
        ['stam','temp','hung','sani'].forEach(k => {
            if (player.stats[k] < player.minStats[k]) player.minStats[k] = player.stats[k];
        });
        if (player.deathRisk > player.maxDeathRisk) player.maxDeathRisk = player.deathRisk;
    }

    /* --- TOGGLE DIRECTION --- */
    function toggleDirection() {
        if (player.progress <= 0 || player.progress >= 100) return; 
        
        if (player.summitAborted && player.isDescending) {
            log("ä½ å·²ç¶“æ”¾æ£„äº†é€™æ¬¡æ”»é ‚ï¼Œå¿…é ˆå…ˆå›åˆ°ç‡Ÿåœ°æ•´è£œæ‰èƒ½å†æ¬¡å˜—è©¦ã€‚", "critical");
            return;
        }

        player.isDescending = !player.isDescending;
        updateToggleBtn();
    }

    function updateToggleBtn() {
        const btn = document.getElementById('btn-toggle');
        if (player.isDescending) {
            btn.innerText = "â¬‡ ä¸‹æ’¤ä¸­ (é»æ“Šåˆ‡æ›)";
            btn.style.color = "#4caf50";
            btn.style.borderColor = "#4caf50";
        } else {
            btn.innerText = "â¬† æ”»é ‚ä¸­ (é»æ“Šåˆ‡æ›)";
            btn.style.color = "var(--accent-blue)";
            btn.style.borderColor = "var(--accent-blue)";
        }
        updateHUD(); 
    }

    /* --- GAME LOOP --- */
    function actionClimb() {
        if(checkDeath()) return;

        if(player.progress <= 0) player.isDescending = false;
        if(player.progress >= 100) player.isDescending = true;
        updateToggleBtn();

        if (!player.isDescending && player.progress > 80 && !player.eventHistory.includes('fix_summit')) {
            player.eventHistory.push('fix_summit');
            triggerSummitPushEvent();
            return; 
        }

        let realProgress = (player.stats.stam / 100) * 2.0 + 0.6; 
        if (player.isDescending) realProgress *= 2; 

        const weight = getWeight();
        let stamCost = 3 + (weight * 0.4); 
        if (player.gear.includes('crampons')) stamCost *= 0.8;

        const env = getEnvFactors();
        let activeWarmth = 0;
        player.gear.forEach(id => {
            let it = ITEMS.find(i=>i.id===id);
            if(it.warm) activeWarmth += it.warm;
        });

        let baseTempLoss = player.isNight ? env.climb.night : env.climb.day;
        
        let bzStamMult = 1;
        let bzTempMult = 1;
        let bzSaniMult = 1;

        if (player.blizzard.active) {
            bzStamMult = 2; bzTempMult = 3; bzSaniMult = 2;
            if (player.gear.includes('headlamp')) {
                bzStamMult *= 0.9; // é«”åŠ›æ¶ˆè€—æ¸›å°‘ 10% (ä½ çš„è¦æ±‚)
                bzSaniMult = 1.0;  // [å»ºè­°] åŒæ™‚æ¶ˆé™¤æš´é¢¨é›ªçš„ç†æ™ºæ‡²ç½° (åŸæœ¬æ˜¯ x2)
            }
            player.blizzard.timer--;
            if (player.blizzard.timer <= 0) {
                player.blizzard.active = false;
                log("æš´é¢¨é›ªçµ‚æ–¼åœäº†ã€‚", "event");
            }
        } else {
            // Difficulty-based Blizzard Chance
            let baseChance = 0.02; 
            if (player.progress >= 80) baseChance = 0.05;
            else if (player.progress >= 60) baseChance = 0.03;
            
            // Apply Difficulty Modifier
            let finalChance = baseChance * DIFFICULTIES[currentDiff].bzMod;

            if (Math.random() < finalChance) {
                player.blizzard.active = true;
                player.blizzard.timer = 20;
                log("ç‹‚é¢¨å‘¼å˜¯ï¼ä¸€å ´å¯æ€•çš„æš´é¢¨é›ªé™è‡¨äº†ã€‚(ç’°å¢ƒå¤±æº«x3, æ¶ˆè€—x2)", "critical");
            }
        }

        let tempCost = Math.max(0, (baseTempLoss * bzTempMult) - activeWarmth);
        
        const hypoxiaMult = player.hypoxiaMode ? 2 : 1;
        
        // Difficulty Multiplier
        const diffMult = DIFFICULTIES[currentDiff].mult;
// --- ç™»å±±æ–é‚è¼¯ (Zone 1/2 + ä¸‹æ’¤å„ªåŒ–) ---
    if (player.gear.includes('poles')) {
        // 1. ä¸‹æ’¤æ¨¡å¼ï¼šå…¨ç¨‹ç”Ÿæ•ˆï¼Œä¿è­·è†è“‹
        // å›ºå®šæ¸›å… 2 é» (é€™åœ¨é«”åŠ›è€—ç›¡æ™‚éå¸¸å·¨å¤§)
        if (player.isDescending) {
            stamCost = Math.max(1, stamCost - 2);
        }
        // 2. ä¸Šå‡æ¨¡å¼ï¼šåƒ…åœ¨ C2 (é€²åº¦40) ä¹‹å‰ç”Ÿæ•ˆ
        // ç™¾åˆ†æ¯”æ¸›å…ï¼Œé©åˆé•·è·é›¢å¹³ç·©åœ°å½¢
        else if (player.progress < 40) {
            stamCost *= 0.7; // é«”åŠ›æ¶ˆè€— -30%
        }
        // 3. Zone 3 (é€²åº¦40) ä»¥ä¸Šï¼š
        // é€²å…¥æ´›å­å£å‚ç›´å†°é¢ï¼Œç™»å±±æ–å¤±å»ä½œç”¨ (ç„¡æ•ˆæœï¼Œåƒ…ä½œç‚ºè² é‡)
    }
        player.stats.stam -= (stamCost * hypoxiaMult * bzStamMult * diffMult);
        player.stats.temp -= (tempCost * diffMult); 
        player.stats.hung -= (3 * diffMult); 
        let saniCost = player.isNight ? 6 : 3;
        if (player.isNight && player.gear.includes('headlamp')) {
        saniCost *= 0.5;
        }
        player.stats.sani -= (saniCost * hypoxiaMult * bzSaniMult * diffMult);
        
        player.stepInDay++;
        player.totalSteps++;

        if (!player.isDescending && player.progress + realProgress > player.maxProgress) {
            player.maxProgress = player.progress + realProgress;
        }

        if (player.progress < 80 && player.eventHistory.includes('fix_summit')) {
            player.eventHistory = player.eventHistory.filter(e => e !== 'fix_summit');
            player.hypoxiaMode = false;
            document.getElementById('hypoxia-alert').style.display = 'none';
            log("é›¢é–‹äº†æ­»äº¡åœ°å¸¶ï¼Œä½ çš„èº«é«”ç‹€æ³æš«æ™‚å›ç©©ï¼Œä½†å†æ¬¡æ”»é ‚éœ€é‡æ–°èª¿æ•´å‘¼å¸ã€‚", "event");
        }

        let nextCamp = CAMPS.find(c => c > player.progress);
        if (player.isDescending) nextCamp = [...CAMPS].reverse().find(c => c < player.progress);
        
        let moved = false;
        let reachedCamp = false;
        
        if (!player.isDescending) {
            player.progress += realProgress;
            moved = true;
            if (nextCamp && player.progress >= nextCamp) {
                player.progress = nextCamp;
                reachedCamp = true;
            }
        } else {
            player.progress -= realProgress;
            moved = true;
            if (nextCamp !== undefined && player.progress <= nextCamp) {
                player.progress = nextCamp;
                if(nextCamp === 0) {
                    endGame(true);
                    return;
                }
                reachedCamp = true;
            }
        }

        if (player.hypoxiaMode && player.progress < 80) {
            player.hypoxiaMode = false;
            document.getElementById('hypoxia-alert').style.display = 'none';
        }

        checkTimePassage();
        checkRiskEvents();

        if (reachedCamp) {
            triggerCampEvent(nextCamp);
            return;
        }

        const eventProb = player.isNight ? 0.35 : 0.25;
        const shouldTriggerEvent = Math.random() < eventProb;
        
        if (shouldTriggerEvent) {
            handleRandomEvent();
        } else {
            if (Math.random() < 0.7) {
                generateFlavorText();
            } else {
                updateHUD();
            }
        }
        
        checkDeath();
    }

    function checkTimePassage() {
        if (player.stepInDay >= DAY_LENGTH) {
            player.stepInDay = 0; 
            player.dayCount++;
            player.isNight = false; 
            document.getElementById('main-view').classList.remove('night-mode');
            log(`ç¬¬ ${player.dayCount} å¤©ï¼šæ¼«é•·çš„é»‘å¤œéå»äº†ï¼Œé»æ˜ç…§åœ¨é›ªå±±ä¸Šã€‚`, "event");
            player.stats.sani += 5;
        } else if (player.stepInDay > DAY_STEPS && !player.isNight) {
            player.isNight = true;
            log("å¤ªé™½ä¸‹å±±äº†ï¼Œæ°£æº«é©Ÿé™ã€‚", "critical");
            document.getElementById('main-view').classList.add('night-mode');
        }
    }

/* --- SHOVEL & SNOW CAVE SYSTEM (UPDATED) --- */
    function performSnowCaveRest() {
        // å…ˆæª¢æŸ¥ç‹€æ…‹ï¼Œé¿å…æ­»äººæŒ–æ´
        if(checkDeath()) return;

        log("ä½ é–‹å§‹æŒ–æ˜ä¸¦èº²å…¥é›ªæ´ï¼Œæ™‚é–“åœ¨å¯’é¢¨ä¸­ç·©æ…¢æµé€...", "event");

        const duration = 20; // é›ªéŸæ¶ˆè€— 20 æ™‚é–“å–®ä½
        let totalStamGain = 0;
        let totalTempLost = 0;
        
        // --- æ ¸å¿ƒä¿®æ”¹ï¼šå¤šæ¬¡çµç®—è¿´åœˆ ---
        for (let i = 0; i < duration; i++) {
            
            // 1. æ¯ä¸€æ­¥éƒ½é€²è¡Œæ­»äº¡åˆ¤å®š (é«”ç¾ç·Šæ€¥é¿éšªçš„é¢¨éšª)
            if (checkDeath()) return; 

            // 2. æ™‚é–“æµé€
            player.stepInDay++;
            player.totalSteps++;
            checkTimePassage(); // æª¢æŸ¥æ˜¯å¦æ—¥å¤œäº¤æ›¿ï¼Œé€™æœƒå½±éŸ¿ä¸‹æ–¹çš„ env æ•¸å€¼

            // 3. æ¢å¾©é«”åŠ›èˆ‡æ¶ˆè€—é£½é£Ÿåº¦ (å¹³å‡åˆ†æ”¤åˆ°æ¯ä¸€æ­¥)
            // ç¸½å…± +30 é«”åŠ›, -20 é£½é£Ÿåº¦
            player.stats.stam += 1.5;   
            player.stats.hung -= 1; 
            if (player.stats.stam > 100) player.stats.stam = 100;

            // 4. è¨ˆç®—ç’°å¢ƒå› ç´ 
            const env = getEnvFactors();
            let staticWarmth = 0;
            player.gear.forEach(id => {
                let it = ITEMS.find(i=>i.id===id);
                if(it.campWarm) staticWarmth += it.campWarm;
            });

            // 5. è™•ç†æš´é¢¨é›ª
            let currentBzMult = 1; // é è¨­ç‚º 1 (æ­£å¸¸å¤©æ°£)

            if (player.blizzard.active) {
                currentBzMult = 1.5; // åªæœ‰åœ¨æš´é¢¨é›ªæ´»èºæ™‚ï¼Œæ‰æ”¹ç‚º 1.5
    
                player.blizzard.timer--; 
                if (player.blizzard.timer <= 0) {
                    player.blizzard.active = false;
                    log("é›ªæ´å¤–é¢çš„é¢¨é›ªåœäº†ã€‚", "event");
                    // ä¸‹ä¸€åœˆè¿´åœˆæ™‚ï¼ŒcurrentBzMult å°±æœƒè®Šå› 1
                }
            }
            // 6. è¨ˆç®—é€™ä¸€å°æ­¥çš„é«”æº«æµå¤±
            let baseLoss = player.isNight ? env.rest.night : env.rest.day;
            const diffMult = DIFFICULTIES[currentDiff].mult;
            
            // åŸºç¤æµå¤± - è£å‚™ä¿æš–
            let rawLoss = (baseLoss * currentBzMult * diffMult) - staticWarmth;
            
            // é›ªéŸä¿è­·æ©Ÿåˆ¶ï¼š
            // å› ç‚ºæˆ‘å€‘è¦çµç®— 20 æ¬¡ï¼Œæ‰€ä»¥å–®æ¬¡æµå¤±å¿…é ˆå¾ˆä½ï¼Œå¦å‰‡å¿…æ­»ã€‚
            // é€™è£¡è¨­å®šç‚º rawLoss / 10ã€‚
            // é‚è¼¯ï¼šæŒ–æ´èº²é¿äº†çµ•å¤§éƒ¨åˆ†å¯’é¢¨ï¼Œä½†åœ°æ¿é‚„æ˜¯å†°çš„ã€‚
            // ç¸½æµå¤±é‡ç´„ç‚ºï¼š(åŸç’°å¢ƒæµå¤± / 10) * 20 = 2å€çš„åŸç’°å¢ƒå–®æ­¥æµå¤±ã€‚
            // é€™æ¯”å¸³ç¯·(å¯èƒ½å›æº«)å·®ï¼Œä½†æ¯”éœ²å®¿(20å€æµå¤±)å¼·å¤ªå¤šã€‚
            let stepLoss = Math.max(0, rawLoss) / 10; 
            
            player.stats.temp -= stepLoss;
            totalTempLost += stepLoss;
        }

        // è¿´åœˆçµæŸå¾Œçš„UIæ›´æ–°
        updateHUD();
        closeModal();
        
        // ç¸½çµå ±å‘Š
        log(`é›ªæ´åº‡è­·çµæŸã€‚é›–ç„¶é«”æº«æµå¤±äº†ï¼Œä½†ä½ æ’éäº†é€™æ®µæ™‚é–“ã€‚(é«”åŠ›+30 / é£½é£Ÿåº¦-20)`, "event");
    }
    function actionRest() {
        if(checkDeath()) return;
        player.stats.stam += 15;
        player.stats.hung -= 5;
        player.stepInDay++; 
        player.totalSteps++; 

        const env = getEnvFactors();
        let staticWarmth = 0;
        player.gear.forEach(id => {
            let it = ITEMS.find(i=>i.id===id);
            if(it.campWarm) staticWarmth += it.campWarm;
        });

        let baseLoss = player.isNight ? env.rest.night : env.rest.day;
        
        let bzTempMult = 1;
        if (player.blizzard.active) {
            bzTempMult = 3;
            player.blizzard.timer--;
            if (player.blizzard.timer <= 0) {
                player.blizzard.active = false;
                log("æš´é¢¨é›ªçµ‚æ–¼åœäº†ã€‚", "event");
            }
        } else {
             let baseChance = 0.02; 
             if (player.progress >= 80) baseChance = 0.05;
             else if (player.progress >= 60) baseChance = 0.03;
             
             let finalChance = baseChance * DIFFICULTIES[currentDiff].bzMod;

             if (Math.random() < finalChance) {
                player.blizzard.active = true;
                player.blizzard.timer = 20;
                log("ç‹‚é¢¨å‘¼å˜¯ï¼ä¸€å ´å¯æ€•çš„æš´é¢¨é›ªé™è‡¨äº†ã€‚(ç’°å¢ƒå¤±æº«x3, æ¶ˆè€—x2)", "critical");
            }
        }

        // Apply Difficulty Multiplier
        const diffMult = DIFFICULTIES[currentDiff].mult;
        let tempCost = Math.max(0, (baseLoss * bzTempMult * diffMult) - staticWarmth);
        
        player.stats.temp -= tempCost;

        if (tempCost > 10) {
            log(`ä½ åœ¨${env.desc}çš„å¯’é¢¨ä¸­ä¼‘æ¯ï¼Œé«”æº«ä¸å‡åé™ã€‚`, "critical");
        } else {
            log("åŸåœ°å–˜æ¯ç‰‡åˆ»ï¼Œé«”åŠ›ç¨ç¨æ¢å¾©ã€‚", "normal");
        }
        
        checkTimePassage();
        updateHUD();
    }

    /* --- CAMP SYSTEM --- */
    function triggerCampEvent(campLevel) {
        updateHUD();
        const isSummit = campLevel === 100;
        
        if (isSummit) {
            player.hasSummited = true; 
            player.isDescending = true; 
            
            if (player.hypoxiaMode) {
                player.summitedWithoutO2 = true;
                log("ã€å‚³å¥‡æ™‚åˆ»ã€‘ä½ ä»¥ç„¡æ°§ç‹€æ…‹ç«™åœ¨äº†ä¸–ç•Œä¹‹å·”ï¼", "critical");
            }
            updateToggleBtn();
        }
        
        let campText = CAMP_DESC[campLevel] || "ç‡Ÿåœ°";
        let cleanDesc = campText.replace(/<br>/g, " ");
        log(`[ç‡Ÿåœ°è¨˜éŒ„] ${cleanDesc}`, "event");

        let htmlContent = `
            <div class="camp-desc-box">${campText}</div>
            <div style="margin-bottom:15px;">åœ¨ç‡Ÿåœ°ä½ å¯ä»¥æ•´ç†è£å‚™ï¼Œä¸¦å˜—è©¦ç¡è¦ºæ¢å¾©é«”åŠ›ã€‚</div>
        `;
        
        if(isSummit) {
             htmlContent = `
                <div class="camp-desc-box">${CAMP_DESC[100]}</div>
                <div style="margin-bottom:15px;">ä½ ç«™åœ¨ä¸–ç•Œä¹‹å·”ã€‚é€™åªæ˜¯ä¸€åŠï¼Œä¸‹å±±æ‰æ˜¯çœŸæ­£çš„æŒ‘æˆ°ã€‚</div>
             `;
        }

        let buttonsHtml = '';

        if (isSummit) {
             buttonsHtml += `<button class="choice-btn" style="color:#4caf50; border-color:#4caf50;" onclick="startDescent()">æ’ä¸Šæ——å¹Ÿï¼Œé–‹å§‹ä¸‹æ’¤</button>`;
        } else {
             buttonsHtml += `<button class="choice-btn" onclick="openCampMenu()">æ•´å‚™èˆ‡ä¼‘æ¯</button>`;
             buttonsHtml += `<button class="choice-btn" onclick="skipCamp()">ä¸ä¼‘æ¯ï¼Œç¹¼çºŒè¶•è·¯</button>`;
        }
        
        let titleText = isSummit ? "æŠµé”ï¼šè–æ¯å³°é ‚" : `æŠµé”ï¼šC${campLevel/20} ç‡Ÿåœ°`;
        showModalHTML(titleText, htmlContent + buttonsHtml);
    }

    function startDescent() {
        player.isDescending = true; 
        updateToggleBtn();
        player.stats.sani += 50; 
        document.getElementById('descend-indicator').style.display = 'inline';
        log("é–‹å§‹ä¸‹æ’¤ã€‚é‡åŠ›æ˜¯ä½ çš„æœ‹å‹ï¼Œä¹Ÿæ˜¯æ•µäººã€‚", "event"); 
        closeModal();
    }

    function skipCamp() {
        log("ä½ é¸æ“‡ä¸ä¼‘æ¯ç¹¼çºŒå‰é€²ã€‚", "critical"); 
        closeModal();
    }

    function openCampMenu() {
        const hasFood = (player.inventory['food'] || 0) > 0;
        const hasFuel = (player.inventory['fuel'] || 0) > 0;
        const foodCount = player.inventory['food'] || 0;
        const fuelCount = player.inventory['fuel'] || 0;

        let html = `
        <p>ç’°å¢ƒæƒ¡åŠ£ï¼Œä½ çš„è³‡æºæ±ºå®šäº†ä»Šæ™šèƒ½æ¢å¾©å¤šå°‘ã€‚</p>
        
        <label class="camp-option">
            <span>é£Ÿç”¨å£ç³§ (åº«å­˜: ${foodCount}) <br><span style="font-size:0.8em; color:#aaa">å›å¾©é£½é£Ÿåº¦</span></span>
            <input type="checkbox" id="chk-food" ${hasFood ? 'checked' : 'disabled'}>
        </label>

        <label class="camp-option">
            <span>ä½¿ç”¨ç‡ƒæ–™ (åº«å­˜: ${fuelCount}) <br><span style="font-size:0.8em; color:#aaa">æŠµç¦¦åš´å¯’</span></span>
            <input type="checkbox" id="chk-fuel" ${hasFuel ? 'checked' : 'disabled'}>
        </label>

        <button class="choice-btn" style="color:var(--accent-gold); border-color:var(--accent-gold); margin-top:20px;" onclick="sleepAction()">ç¢ºèªç¡è¦º (é€²å…¥ä¸‹ä¸€å¤©)</button>
        <button class="choice-btn" onclick="closeModal()">å–æ¶ˆ</button>
        `;

        showModalHTML("ç‡Ÿåœ°æ•´å‚™", html);
    }

    function sleepAction() {
        const useFood = document.getElementById('chk-food')?.checked;
        const useFuel = document.getElementById('chk-fuel')?.checked;

        const hasPolar = player.gear.includes('bag_polar');
        const hasBasic = player.gear.includes('bag_basic');
        const _hasStove = player.gear.includes('stove');

        let restore = 10;
        let tempPenalty = 40;

        if (hasPolar) {
            restore = 50;
            tempPenalty = -30;
        } else if (hasBasic) {
            restore = 50; 
            tempPenalty = 20;
        }
        
        restore += 10; 
        
        if (useFood && player.inventory['food'] > 0) {
            player.inventory['food']--;
            player.stats.hung = 100;
            if(player.inventory['food'] === 0) delete player.inventory['food'];
        }
        
        player.stats.stam += restore;

        if (useFuel && _hasStove && player.inventory['fuel'] > 0) {
            player.inventory['fuel']--;
            player.stats.temp = 100;
            if(player.inventory['fuel'] === 0) delete player.inventory['fuel'];
        } else {
            let coatWarmth = 0;
            player.gear.forEach(id => {
                let it = ITEMS.find(i=>i.id===id);
                if(it.campWarm) coatWarmth += it.campWarm;
            });
            let finalLoss = Math.max(0, tempPenalty - coatWarmth);
            player.stats.temp -= finalLoss;
        }
        
        player.stats.sani += 40;
        player.stepInDay = 0;
        player.dayCount++; 
        player.isNight = false;
        
        if (player.blizzard.active) {
            player.blizzard.active = false;
            log("ä½ åœ¨å¸³ç¯·è£¡èº²éäº†ä¸€å ´æš´é¢¨é›ªã€‚", "event");
        }

        if (player.summitAborted) {
            player.summitAborted = false;
            player.eventHistory = player.eventHistory.filter(e => e !== 'fix_summit');
            log("ç¶“éä¼‘æ¯ï¼Œä½ é‡æ–°ç‡ƒèµ·äº†æŒ‘æˆ°é ‚å³°çš„å‹‡æ°£ã€‚", "event");
        }

        document.getElementById('main-view').classList.remove('night-mode');
        
        if(player.blizzard.active) {
             document.body.classList.add('blizzard-mode');
             document.getElementById('blizzard-alert').style.display = 'inline';
        } else {
             document.body.classList.remove('blizzard-mode');
             document.getElementById('blizzard-alert').style.display = 'none';
        }

        log(`ç¬¬ ${player.dayCount} å¤©ï¼šåœ¨ç‡Ÿåœ°ç¡äº†ä¸€è¦ºï¼Œé«”åŠ›æ¢å¾©ã€‚`, "event");
        updateHUD();
        closeModal();
    }

    /* --- UI UTILS --- */
    function openInventory() {
        let html = `<div style="margin-bottom:10px; border-bottom:1px solid #444; padding-bottom:5px; color:var(--accent-gold)">è£å‚™ (è¢«å‹•æ•ˆæœ)</div>`;
        if (player.gear.length === 0) html += `<div style="color:#666">ç„¡</div>`;
        player.gear.forEach(id => {
            let item = ITEMS.find(i=>i.id===id);
            if (item.type === 'tool') {
                 html += `<div class="inv-row" onclick="useItem('${id}')" style="cursor:pointer; border:1px solid #4a90e2; padding:5px; margin-bottom:5px; background:rgba(74, 144, 226, 0.1);">
                    <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                        <span style="font-weight:bold; color:#4a90e2;">${item.name} [é»æ“Šä½¿ç”¨]</span>
                        <span style="font-size:0.8em; color:#ddd">${item.desc}</span>
                    </div>
                </div>`;
            } else {
                 html += `<div class="inv-row"><span>${item.name}</span><span style="font-size:0.8em; color:#888">${item.desc}</span></div>`;
            }
        });

        html += `<div style="margin:15px 0 10px 0; border-bottom:1px solid #444; padding-bottom:5px; color:var(--accent-blue)">èƒŒåŒ…ç‰©å“ (é»æ“Šä½¿ç”¨)</div>`;
        let hasItem = false;
        for (let id in player.inventory) {
            let count = player.inventory[id];
            if(count > 0) {
                hasItem = true;
                let item = ITEMS.find(i=>i.id===id);
                let extraDesc = "";
                if (id === 'fuel') extraDesc = " (+40é«”æº«)";
                html += `<div class="inv-row" onclick="useItem('${id}')" style="cursor:pointer">
                    <span>${item.name} x${count}</span>
                    <span style="color:#4a90e2">[ä½¿ç”¨${extraDesc}]</span>
                </div>`;
            }
        }
        if (!hasItem) html += `<div style="color:#666">ç©º</div>`;
        
        html += `<button class="choice-btn" style="margin-top:15px" onclick="closeModal()">é—œé–‰</button>`;
        showModalHTML("èƒŒåŒ…æª¢æŸ¥", html);
    }

    function useItem(id) {
        const item = ITEMS.find(i=>i.id===id);

        if(item.type === 'tool') {
             if(id === 'shovel') performSnowCaveRest();
             return;
        }
        
        if(id === 'dex') {
            const consumedHunger = player.stats.hung * 0.8;
            player.stats.hung -= consumedHunger;
            const stamGain = consumedHunger * 1.0;
            const tempGain = consumedHunger * 0.5;
            player.stats.stam += stamGain;
            player.stats.temp += tempGain;
            player.stats.sani += 40; 
            log(`æ³¨å°„è…ä¸Šè…ºç´ ï¼ç‡ƒç‡’äº† ${Math.round(consumedHunger)} é»é£½é£Ÿåº¦ï¼Œæ›å–é«”èƒ½çˆ†ç™¼ã€‚`, "critical");
        }
        else if(item.effect) {
            if(item.effect.stam) player.stats.stam += item.effect.stam;
            if(item.effect.hung) player.stats.hung += item.effect.hung;
            if(item.effect.sani) player.stats.sani += item.effect.sani;
            if(item.effect.temp) player.stats.temp += item.effect.temp;
            if(item.effect.sanity_reset) player.stats.sani = 100;
        }
        
        player.inventory[id]--;
        if(player.inventory[id] <= 0) delete player.inventory[id];
        log(`ä½¿ç”¨äº† ${item.name}`, "normal");
        updateHUD();
        closeModal();
    }

    function showModalHTML(title, html) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-body').innerHTML = html;
        document.getElementById('modal-actions').innerHTML = ''; 
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function showModal(title, text, opts) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-body').innerText = text;
        const actContainer = document.getElementById('modal-actions');
        actContainer.innerHTML = '';
        opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = opt.txt;
            btn.onclick = () => { 
                opt.act();
                closeModal();
            };
            actContainer.appendChild(btn);
        });
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function formatTemp(val) { return (37 + (val-100)/10).toFixed(1) + 'Â°C'; }

    function getStatColor(val, type) {
        if (type === 'temp') {
            if (val >= 80) return 'text-green'; // > 35.0 C
            if (val <= 30) return 'text-red';   // < 30.0 C
        } else {
            if (val >= 70) return 'text-green';
            if (val <= 30) return 'text-red';
        }
        return '';
    }

    function updateHUD() {
        normalizeStats();

        let isCritical = false;
        ['stam', 'temp', 'hung', 'sani'].forEach(k => {
            const val = Math.round(player.stats[k]);
            const bar = document.getElementById(`bar-${k}`);
            document.getElementById(`val-${k}`).innerText = val;
            bar.style.width = Math.max(0, val) + '%';
            
            const container = bar.parentElement.parentElement;
            if(val < 20) {
                container.classList.add('warning-stat');
                isCritical = true;
            } else {
                container.classList.remove('warning-stat');
            }
        });
        
        const app = document.getElementById('app');
        if (isCritical || player.blizzard.active) app.classList.add('critical-bg');
        else app.classList.remove('critical-bg');
        
        if (player.blizzard.active) {
            document.body.classList.add('blizzard-mode');
            document.getElementById('blizzard-alert').style.display = 'inline';
        } else {
            document.body.classList.remove('blizzard-mode');
            document.getElementById('blizzard-alert').style.display = 'none';
        }

        const deathRiskEl = document.getElementById('death-risk');
        if (player.deathRisk > 0) {
            deathRiskEl.style.display = 'inline';
            deathRiskEl.innerText = `â˜  æ­»äº¡ç‡: ${player.deathRisk}%`;
        } else {
            deathRiskEl.style.display = 'none';
        }

        document.getElementById('val-temp').innerText = formatTemp(player.stats.temp);
        
        const timeStr = player.isNight ? "â˜¾ æ·±å¤œ" : "â˜€ ç™½æ™";
        document.getElementById('txt-time').innerText = `${timeStr} (Step: ${player.stepInDay}/${DAY_STEPS})`;
        
        let rawDistance = 0;
        if (!player.isDescending) {
            let remainder = player.progress % 20;
            rawDistance = (remainder === 0 && player.progress > 0) ? 0 : (20 - remainder);
        } else {
            rawDistance = player.progress % 20;
        }
        let percentRemaining = (rawDistance / 20) * 100;
        percentRemaining = Math.max(0, Math.min(100, percentRemaining));
        document.getElementById('val-dist-camp').innerText = percentRemaining.toFixed(1) + '%';

        // Detailed Location Mapping
        document.getElementById('txt-location').innerText = getDetailedLocationName(player.progress);
        
        // Background Update
        setBg(player.progress);
    }

    function log(msg, type) {
        const div = document.createElement('div');
        div.className = `log-entry ${type||''}`;
        // å°‡ innerText æ”¹ç‚º innerHTMLï¼Œé€™æ¨£ç€è¦½å™¨æ‰æœƒåŸ·è¡Œä½ çš„é¡è‰²æ¨™ç±¤
        div.innerHTML = msg; 
        const view = document.getElementById('main-view');
        view.appendChild(div);
        view.scrollTop = view.scrollHeight;
    }
    /* --- SUMMIT PUSH EVENT --- */
function triggerSummitPushEvent() {
    let html = `
        <div style="margin-bottom:15px;">ä½ å·²é€²å…¥æ­»äº¡åœ°å¸¶ (8000m+)ã€‚ç©ºæ°£ä¸­çš„æ°§æ°£å«é‡åªæœ‰æµ·å¹³é¢çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚</div>
        <p>ä½ çš„åš®å°åš´è‚…åœ°çœ‹è‘—ä½ ï¼šã€Œå¾é€™è£¡é–‹å§‹ï¼Œæ¯ä¸€æ­¥éƒ½åœ¨æ¶ˆè€—ç”Ÿå‘½ã€‚ä½ ç¢ºå®šè¦ç¹¼çºŒå—?ã€</p>
    `;
    
    let opts = [];
    
    // é¸é …1ï¼šä½¿ç”¨æ°§æ°£ç“¶
    if (player.inventory['oxygen'] && player.inventory['oxygen'] > 0) {
        opts.push({
            txt: `<span style="color:#4caf50; font-weight:bold;">ä½¿ç”¨æ°§æ°£ç“¶ç¹¼çºŒæ”»é ‚ (å‰©é¤˜: ${player.inventory['oxygen']})</span>`,
            act: () => {
                // [æ–°å¢] æ‰£é™¤æ°§æ°£ç“¶é‚è¼¯
                if (player.inventory['oxygen'] > 0) {
                    player.inventory['oxygen']--;
                    if (player.inventory['oxygen'] === 0) delete player.inventory['oxygen'];
                }
                
                // è§£é™¤ç¼ºæ°§ç‹€æ…‹
                player.hypoxiaMode = false;
                document.getElementById('hypoxia-alert').style.display = 'none';
                log("ä½ æˆ´ä¸Šäº†æ°§æ°£é¢ç½©ã€‚é›–ç„¶æ²‰é‡ï¼Œä½†èƒ½ç¶­æŒç”Ÿå‘½ã€‚", "event");
                
                // æ›´æ–°ä»‹é¢ (ç¢ºä¿èƒŒåŒ…é¡¯ç¤ºæ­£ç¢º)
                updateHUD(); 
                closeModal();
            }
        });
    }
    
    // é¸é …2ï¼šç„¡æ°§æ”»é ‚
    opts.push({
        txt: `<span style="color:#d9534f; font-weight:bold;">æ‹’çµ•æ°§æ°£ï¼Œæ†‘æ„å¿—åŠ›æ”»é ‚ (æ¥µåº¦å±éšª)</span>`,
        act: () => {
            player.hypoxiaMode = true;
            document.getElementById('hypoxia-alert').style.display = 'inline';
            log("ä½ é¸æ“‡äº†ç„¡æ°§æ”»é ‚ã€‚é€™æ˜¯å°äººé¡æ¥µé™çš„æŒ‘æˆ°ã€‚(æ‰€æœ‰æ¶ˆè€— x2)", "critical");
            closeModal();
        }
    });
    
    // é¸é …3ï¼šæ”¾æ£„æ”»é ‚
    opts.push({
        txt: `<span style="color:#4a90e2;">æ”¾æ£„æ”»é ‚ï¼Œé–‹å§‹æ’¤é€€</span>`,
        act: () => {
            player.isDescending = true;
            player.summitAborted = true;
            updateToggleBtn();
            log("ä½ åšå‡ºäº†è‰±é›£çš„æ±ºå®š â€”â€” æ´»è‘—å›å»æ¯”ç™»é ‚æ›´é‡è¦ã€‚", "descend");
            closeModal();
        }
    });
    
    showModalHTML("æ­»äº¡åœ°å¸¶", html + opts.map((opt, i) => 
        `<button class="choice-btn" onclick="executeSummitChoice(${i})">${opt.txt}</button>`
    ).join(''));
    
    // å­˜å„²é¸é …åˆ°å…¨å±€è®Šé‡ä»¥ä¾›æŒ‰éˆ•èª¿ç”¨
    window.summitChoices = opts;
}

function executeSummitChoice(index) {
    if (window.summitChoices && window.summitChoices[index]) {
        window.summitChoices[index].act();
    }
}

/* --- RISK EVENT SYSTEM --- */
function checkRiskEvents() {
    // åš´é‡ä½æº«é¢¨éšª
    if (player.stats.temp < 20 && Math.random() < 0.15) {
        log("ä½ çš„æ‰‹æŒ‡å·²ç¶“å¤±å»çŸ¥è¦ºï¼Œå‡å‚·é¢¨éšªæ¥µé«˜!", "critical");
        player.deathRisk += 10;
    }
    
    // åš´é‡é£½é£Ÿåº¦é¢¨éšª
    if (player.stats.hung < 15 && Math.random() < 0.12) {
        log("æ¥µåº¦é£½é£Ÿåº¦è®“ä½ ç”¢ç”Ÿå¹»è¦ºï¼Œè…³æ­¥æ–æ–æ™ƒæ™ƒã€‚", "critical");
        player.stats.sani -= 15;
    }
    
    // ç²¾ç¥å´©æ½°é¢¨éšª
    if (player.stats.sani < 25 && Math.random() < 0.18) {
        log("ä½ é–‹å§‹è³ªç–‘è‡ªå·±ç‚ºä»€éº¼è¦ä¾†é€™è£¡...", "sanity");
        player.stats.stam -= 10;
    }
}

/* --- [FIXED] HANDLE RANDOM EVENT LOGIC --- */
    function handleRandomEvent() {
        let pool = [];
        let isMalignant = false;
        let eventType = "event"; 

        if (player.blizzard.active) {
            pool = EVENTS_DB.blizzard ? EVENTS_DB.blizzard : [];
            eventType = "blizzard";
        } 
        else if (player.stats.sani < 30 && Math.random() < 0.7) {
            pool = EVENTS_DB.malignant ? EVENTS_DB.malignant : [];
            isMalignant = true;
            eventType = "malignant";
        } 
        else {
            let zoneIdx = Math.floor(player.progress / 20);
            if (zoneIdx > 4) zoneIdx = 4;
            
            if (EVENTS_DB.zones && EVENTS_DB.zones[zoneIdx]) {
                // Filter out one-time events, but if pool is empty, maybe fallback?
                // For now, keep story events one-time.
                pool = EVENTS_DB.zones[zoneIdx].filter(e => !player.eventHistory.includes(e.id));
            } else {
                pool = [];
            }
            isMalignant = false;
        }

        // FAIL-SAFE: If pool is empty, trigger flavor text
        if (!pool || pool.length === 0) {
            generateFlavorText(); 
            return;
        }

        const ev = pool[Math.floor(Math.random() * pool.length)];
        // Only push to history if it's a zone event (story event)
        // Blizzard and Malignant events can repeat (optional, but good for gameplay)
        if (!player.blizzard.active && !isMalignant) {
             player.eventHistory.push(ev.id);
        }

        const processedOpts = ev.opts.filter(o => !o.cond || o.cond(player)).map(o => ({
            txt: o.txt,
            act: () => {
                const resultText = o.act(); 
                log(`> é¸æ“‡ï¼š${o.txt}`, "normal");
                
                let finalLogType = isMalignant ? "malignant" : "event";
                if(player.blizzard.active) finalLogType = "blizzard";
                
                log(resultText, finalLogType);
                updateHUD();
                checkDeath();
            }
        }));

        showModal(ev.title, ev.text, processedOpts);
    }

    function generateFlavorText() {
    const p = player.progress;
    const isNight = player.isNight;
    const isDescending = player.isDescending;
    
    let texts = [];
    
    // ä¸‹æ’¤æ™‚çš„ç‰¹æ®Šæ–‡å­—
    if (isDescending && p > 0) {
        texts = [
            "ä¸‹å±±æ¯”ä¸Šå±±æ›´å±éšªï¼Œæ¯ä¸€æ­¥éƒ½è¦å°å¿ƒç¿¼ç¿¼ã€‚",
            "é‡åŠ›æ˜¯ä½ çš„æœ‹å‹ï¼Œä¹Ÿæ˜¯ä½ çš„æ•µäººã€‚",
            "ä½ çš„è†è“‹é–‹å§‹æŠ—è­°é€™æ¼«é•·çš„ä¸‹é™ã€‚",
            "å›é ­çœ‹ï¼Œä½ å‰›æ‰èµ°éçš„è·¯ç°¡ç›´ä¸å¯æ€è­°ã€‚"
        ];
    }
    // å¤œæ™šçš„ç‰¹æ®Šæ–‡å­—
    else if (isNight) {
        texts = [
            "é ­ç‡ˆçš„å…‰æŸåœ¨é»‘æš—ä¸­é¡¯å¾—å¦‚æ­¤å­¤ç¨ã€‚",
            "å¤œæ™šçš„å¯’å†·æ¯”ç™½å¤©æ›´åŠ åˆºéª¨ã€‚",
            "æ˜Ÿç©ºç¾å¾—ä»¤äººçª’æ¯ï¼Œä½†ä½ æ²’æ™‚é–“æ¬£è³ã€‚",
            "é»‘æš—ä¸­ï¼Œä½ åªèƒ½ä¾é è…³ä¸‹çš„æ„Ÿè¦ºå‰é€²ã€‚"
        ];
    }
    // æ ¹æ“šé«˜åº¦çš„é¢¨å‘³æ–‡å­—
    else if (p < 20) {
        texts = [
            "é è™•å†°å¡”å´©å¡Œçš„é›·é³´è²è®“äººå¿ƒæ‚¸ã€‚",
            "ä½ çœ‹è¦‹æ¢¯å­åº•ä¸‹æ·±è—è‰²çš„ç„¡åº•æ·±æ·µã€‚",
            "å†°çˆªæŠ“åœ¨å …ç¡¬çš„è—å†°ä¸Šç™¼å‡ºåˆºè€³è²éŸ¿ã€‚",
            "ä¸€éš»é›ªé´‰åœ¨é è™•ç›¤æ—‹ï¼Œä¼¼ä¹åœ¨è§€å¯Ÿä½ ã€‚",
            "å†°å·æ·±è™•å‚³ä¾†ä½æ²‰çš„å‘»åŸè²ã€‚"
        ];
    }
    else if (p < 40) {
        texts = [
            "æ­»ä¸€æ¨£çš„å¯‚éœï¼Œåªèƒ½è½è¦‹å¿ƒè·³è²ã€‚",
            "é™½å…‰åå°„å¼·çƒˆï¼Œæ„Ÿè¦ºåƒæ˜¯åœ¨å¾®æ³¢çˆè£¡ã€‚",
            "å‰é¢çš„è…³å°è¢«é¢¨å¹å¾—å¿«æ¶ˆå¤±äº†ã€‚",
            "ä½ çš„å½±å­åœ¨é›ªåœ°ä¸Šæ‹–å¾—å¾ˆé•·ã€‚",
            "é è™•çš„å±±å³°åœ¨ç†±æµªä¸­æ‰­æ›²è®Šå½¢ã€‚"
        ];
    }
    else if (p < 60) {
        texts = [
            "æ´›å­å£çš„å†°å£é™¡å³­å¾—è®“äººçµ•æœ›ã€‚",
            "ä¸€é¡†å°çŸ³é ­å¾é ­ç›”æ—æ“¦éã€‚",
            "ä¸‹æ–¹çš„ç‡Ÿåœ°å·²ç¶“è®Šæˆäº†å°é»‘é»ã€‚",
            "ä½ èƒ½çœ‹è¦‹é è™•çš„å“å¥§å‹å³°ã€‚",
            "è·¯ç¹©åœ¨é¢¨ä¸­ç™¼å‡ºå—¡å—¡çš„æŒ¯å‹•è²ã€‚"
        ];
    }
    else if (p < 80) {
        texts = [
            "é¢¨è²åƒå™´æ°£æ©Ÿå¼•æ“ä¸€æ¨£å’†å“®ã€‚",
            "è·¯é‚Šæœ‰ä¸€å€‹è¢«éºæ£„çš„æ°§æ°£ç“¶ï¼ŒåŠåŸ‹åœ¨ç¢çŸ³ä¸­ã€‚",
            "æ®˜ç ´çš„å¸³ç¯·åœ¨é¢¨ä¸­ç˜‹ç‹‚æ‹æ‰“ã€‚",
            "é»ƒå¸¶å²©å±¤çš„å²©çŸ³é¬†å‹•å¾—ä»¤äººä¸å®‰ã€‚",
            "æ¯ä¸€æ¬¡å‘¼å¸éƒ½åƒåœ¨å¸ç ‚ç´™ã€‚"
        ];
    }
    else {
        texts = [
            "å·¦é‚Šæ˜¯å°¼æ³Šçˆ¾ï¼Œå³é‚Šæ˜¯è¥¿è—ï¼Œå…©é‚Šéƒ½æ˜¯è¬ä¸ˆæ·±æ·µã€‚",
            "ä½ çœ‹è¦‹äº†å‚³èªªä¸­çš„ã€Œç¶ é´å­ã€ï¼Œä»–ä¾ç„¶èººåœ¨é‚£è£¡ã€‚",
            "æ¯ä¸€æ­¥éƒ½éœ€è¦å…¨éƒ¨çš„æ„å¿—åŠ›é©…å‹•ã€‚",
            "å¤©ç©ºå‘ˆç¾å‡ºæ·±é‚ƒçš„ç´«é»‘è‰²ï¼Œä½ å¹¾ä¹èƒ½çœ‹è¦‹æ˜Ÿæ˜Ÿã€‚",
            "å¸Œæ‹‰é‡Œå°éšä¸Šæ›æ»¿äº†å½©è‰²çš„è·¯ç¹©ã€‚",
            "å—å³°çš„è¼ªå»“åœ¨ä½ çœ¼å‰è¶Šä¾†è¶Šæ¸…æ™°ã€‚"
        ];
    }
    
    const msg = texts[Math.floor(Math.random() * texts.length)];
    log(msg, "flavor");
    updateHUD(); // ç¢ºä¿UIæ›´æ–°
}

function checkDeath() {
        // 1. è¨ˆç®—æœ‰å¹¾é …æ•¸å€¼æ­¸é›¶ (å±æ€¥ç¨‹åº¦)
        let criticalCount = 0;
        if (player.stats.stam <= 0) criticalCount++;
        if (player.stats.hung <= 0) criticalCount++;
        if (player.stats.sani <= 0) criticalCount++;
        if (player.stats.temp <= 0) criticalCount++;

        // åˆ¤æ–·æ˜¯å¦è™•æ–¼è‡´å‘½ç‹€æ…‹
        const isDeadly = criticalCount > 0;

        if (isDeadly) {
            // --- å¹¾ä½•ç´šæ•¸ç´¯åŠ é‚è¼¯ ---
            
            // å¦‚æœç•¶å‰æ­»äº¡ç‡æ˜¯ 0ï¼Œå…ˆè¨­ç‚º 1 ä½œç‚ºèµ·å§‹åŸºæº–
            if (player.deathRisk === 0) player.deathRisk = 1;
            
            // è¨ˆç®—å€ç‡ï¼š(æ­¸é›¶æ•¸é‡ + 1)
            let multiplier = criticalCount + 1;
            
            // åŸ·è¡Œä¹˜æ³•é‹ç®—
            player.deathRisk = player.deathRisk * multiplier;

            // è¨­å®šä¸Šé™ 100%
            if (player.deathRisk > 100) player.deathRisk = 100;

            // ã€é—œéµä¿®æ­£ã€‘åœ¨æ­¤è™•ç«‹åˆ»æ›´æ–°æœ€å¤§æ­»äº¡ç‡ç´€éŒ„ï¼Œç¢ºä¿æ­»å‰é‚£ä¸€åˆ»çš„æ•¸å€¼è¢«è¨˜éŒ„
            if (player.deathRisk > player.maxDeathRisk) {
                player.maxDeathRisk = player.deathRisk;
            }

            // é¡¯ç¤ºè­¦å‘Šæ—¥èªŒ (ä½ æŒ‡å®šçš„æ ¼å¼)
            log(`âš  ç”Ÿå‘½å‚å±ï¼æ­»äº¡ç‡é£†å‡è‡³${player.deathRisk}%`, "critical");
            
            // é€²è¡Œæ­»äº¡åˆ¤å®š
            if (Math.random() * 100 < player.deathRisk) {
                return endGame(false, "ä½ çš„èº«é«”æ©Ÿèƒ½å¾¹åº•å´©æ½°äº†ã€‚");
            }
        } else {
            // --- æ¢å¾©é‚è¼¯ ---
            if (player.deathRisk > 0) {
                // è‹¥å…¨éƒ¨æ•¸å€¼çš†æ¢å¾©ï¼Œæ¯å›åˆ -10
                player.deathRisk -= 10;
                
                // ç¢ºä¿ä¸ä½æ–¼ 0
                if (player.deathRisk < 0) player.deathRisk = 0;
                
                // é¡¯ç¤ºæ¢å¾©è¨Šæ¯
                if (player.deathRisk > 0) {
                     log(`èº«é«”æ©Ÿèƒ½æ­£åœ¨ç·©æ…¢æ¢å¾©... (å‰©é¤˜æ­»äº¡é¢¨éšª: ${player.deathRisk}%)`, "event");
                } else {
                     log("ä½ çš„èº«é«”ç‹€æ³å·²è„«é›¢å±éšªã€‚", "event");
                }
            }
        }
        return false;
    }
function endGame(victory, cause) {
        let outcomeTitle = "";
        let outcomeDesc = "";
        let outcomeClass = "";

        if (victory) {
            if (player.hasSummited) {
                if (player.summitedWithoutO2) {
                    outcomeTitle = "ç„¡æ°§å¤§å¸« (No-O2 Master)";
                    outcomeDesc = "ä½ æ‹’çµ•äº†æ°§æ°£ç“¶çš„èª˜æƒ‘ï¼Œåƒ…æ†‘è‡ªèº«çš„è‚ºæ´»é‡èˆ‡é‹¼éµæ„å¿—å¾æœäº†8848ç±³ã€‚åªæœ‰ä¸åˆ°2%çš„ç™»é ‚è€…åœ¨é€™æ¨£çš„æ¥µé™ä¸­æŒ‘æˆ°æˆåŠŸã€‚";
                    outcomeClass = "text-win";
                } else {
                    outcomeTitle = "å‚³å¥‡èª•ç”Ÿ (Legend)";
                    outcomeDesc = "ä½ ç«™åœ¨ä¸–ç•Œä¹‹å·”ï¼Œä¸¦æ´»è‘—å›ä¾†è¨´èªªé€™ä¸€åˆ‡ã€‚ä½†æ˜¯åˆ‡è¨˜ï¼Œä¸æ˜¯ä½ å¾æœäº†å±±ï¼Œè€Œæ˜¯å±±æ”¾éäº†ä½ ã€‚";
                    outcomeClass = "text-win";
                }
            } else {
                outcomeTitle = "æ™ºè€…ç”Ÿå­˜ (Survivor)";
                outcomeDesc = "ä½ åšå‡ºäº†æœ€è‰±é›£çš„æ±ºå®šâ€”â€”åœ¨é ‚å³°å‰è½‰èº«ã€‚å±±æ°¸é éƒ½åœ¨ï¼Œè€Œä½ æ´»äº†ä¸‹ä¾†ã€‚é€™æ˜¯å‹‡æ°£çš„å¦ä¸€ç¨®å½¢å¼ã€‚";
                outcomeClass = "text-retreat";
            }
        } else {
            if (player.hasSummited) {
                outcomeTitle = "é›ªå±±æ‚²æ­Œ (Tragedy)";
                outcomeDesc = "ä½ æˆåŠŸè§¸æ‘¸åˆ°äº†å¤©ç©ºï¼Œå»æ°¸é ç•™åœ¨äº†æ­¸é€”ã€‚æ¦®è€€èˆ‡éºæ†¾ä¸¦å­˜ã€‚";
                outcomeClass = "text-loss";
            }
            else if (player.hypoxiaMode && !player.hasSummited) {
                outcomeTitle = "é›ªå±±è½å¤« (Reckless Fool)";
                outcomeDesc = "ä½ é«˜ä¼°äº†è‡ªå·±çš„ç”Ÿç†æ¥µé™ï¼Œæ‹’çµ•äº†æ°§æ°£ç“¶çš„æ•‘è´–ã€‚åœ¨8000ç±³ä»¥ä¸Šçš„æ­»äº¡åœ°å¸¶ï¼Œä½ çš„è‚ºæ³¡ä¹¾æ¯ï¼Œæ„è­˜åœ¨ç¼ºæ°§ä¸­æ¶ˆæ•£ã€‚å‹‡æ°£èˆ‡æ„šè ¢å¾€å¾€åªæœ‰ä¸€ç·šä¹‹éš”ã€‚";
                outcomeClass = "text-loss";
            }
            else if (player.isDescending && !player.hasSummited) {
                outcomeTitle = "ç„¡ç›¡çµ•æœ› (Despair)";
                outcomeDesc = "ä½ é¸æ“‡äº†æ”¾æ£„ï¼Œä½†æ­»ç¥ä¾ç„¶æ²’æœ‰æ”¾éä½ ï¼Œä½ åœ¨çµ•æœ›ä¸­èµ°å‘äº†çµ‚çµ";
                outcomeClass = "text-loss";
            } else {
                outcomeTitle = "éš•è½ (Fallen)";
                outcomeDesc = "ä½ åœ¨æ”€ç™»é€”ä¸­å€’ä¸‹ã€‚ä½ çš„èº«é«”å°‡æˆç‚ºå¾Œä¾†è€…çš„è·¯æ¨™ï¼Œæ°¸ä¸è…çˆ›ã€‚(" + cause + ")";
                outcomeClass = "text-loss";
            }
        }

        let maxAlt = Math.floor(5300 + (player.maxProgress * 35));
        if (player.maxProgress >= 100) maxAlt = 8848; 
        
        let bestLoc = getDetailedLocationName(player.maxProgress);
        
        // --- ã€ä¿®æ”¹é»ã€‘ å–å¾—é›£åº¦åç¨±èˆ‡é¡è‰² ---
        const diffConfig = DIFFICULTIES[currentDiff];
        const diffName = diffConfig ? diffConfig.desc : "æœªçŸ¥";
        const diffColor = diffConfig ? diffConfig.color : "#ccc"; // é è¨­ç°è‰²

        const mainViewLog = document.getElementById('main-view').innerHTML;
        let gearList = player.gear.map(id => ITEMS.find(i=>i.id===id).name).join(', ') || "ç„¡";
        let invList = Object.entries(player.inventory).map(([id, count]) => {
            const name = ITEMS.find(i=>i.id===id).name;
            if(ITEMS.find(i=>i.id===id).type === 'tool') return name;
            return `${name} x${count}`;
        }).join(', ') || "ç„¡";

        let html = `
            <div class="result-title ${outcomeClass}">${outcomeTitle}</div>
            <div style="margin-bottom:20px; line-height:1.5;">${outcomeDesc}</div>
            
            <div class="summary-box">
                <div style="color:var(--accent-blue); border-bottom:1px solid #444; margin-bottom:5px;">æ”€ç™»ç´€éŒ„</div>
                <div class="summary-stat-grid">
                    <div>æŒ‘æˆ°é›£åº¦: <span class="stat-val" style="color:${diffColor}">${diffName}</span></div>
                    <div>æœ€é«˜åˆ°é”: <span class="stat-val">${bestLoc}</span></div>
                    <div>æœ€é«˜æµ·æ‹”: <span class="stat-val">${maxAlt}m</span></div>
                    <div>å­˜æ´»å¤©æ•¸: <span class="stat-val">Day ${player.dayCount}</span></div>
                    <div>ç¸½æ­¥æ•¸: <span class="stat-val">${player.totalSteps}</span></div>
                    <div>æœ€å¤§æ­»äº¡ç‡: <span class="text-loss">${player.maxDeathRisk}%</span></div>
                </div>
            </div>

            <div class="summary-box">
                <div style="color:#aaa; border-bottom:1px solid #444; margin-bottom:5px;">æœ€çµ‚ç‹€æ…‹</div>
                <div class="summary-stat-grid">
                    <div>é«”åŠ›: <span class="stat-val ${getStatColor(player.stats.stam)}">${Math.round(player.stats.stam)}</span> <span class="stat-min ${getStatColor(player.minStats.stam)}">(æœ€å°å€¼: ${Math.round(player.minStats.stam)})</span></div>
                    <div>ç†æ™º: <span class="stat-val ${getStatColor(player.stats.sani)}">${Math.round(player.stats.sani)}</span> <span class="stat-min ${getStatColor(player.minStats.sani)}">(æœ€å°å€¼: ${Math.round(player.minStats.sani)})</span></div>
                    <div>é£½é£Ÿåº¦: <span class="stat-val ${getStatColor(player.stats.hung)}">${Math.round(player.stats.hung)}</span> <span class="stat-min ${getStatColor(player.minStats.hung)}">(æœ€å°å€¼: ${Math.round(player.minStats.hung)})</span></div>
                    <div>é«”æº«: <span class="stat-val ${getStatColor(player.stats.temp, 'temp')}">${formatTemp(player.stats.temp)}</span> <span class="stat-min ${getStatColor(player.minStats.temp, 'temp')}">(æœ€å°å€¼: ${formatTemp(player.minStats.temp)})</span></div>
                </div>
            </div>

            <div class="summary-box">
                <div style="color:#aaa; border-bottom:1px solid #444; margin-bottom:5px;">å‰©é¤˜ç‰©è³‡</div>
                <div style="font-size:0.85em;">
                    <div style="margin-bottom:3px;">è£å‚™: ${gearList}</div>
                    <div>èƒŒåŒ…: ${invList}</div>
                </div>
            </div>

            <div style="color:#aaa; font-size:0.9em; margin-bottom:5px;">å®Œæ•´æ—¥èªŒå›é¡§:</div>
            <div class="summary-log-container">
                ${mainViewLog}
            </div>
        `;

        showModalHTML("æ¢éšªå ±å‘Š", html + `<button class="choice-btn" onclick="location.reload()">é‡æ–°é–‹å§‹æ—…ç¨‹</button>`);
        return true;
    }    
    initShop();
</script>

</body>
</html>